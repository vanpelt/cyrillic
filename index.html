<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Serbian Cyrillic Flash Cards</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 100%;
            padding: 40px;
            text-align: center;
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 60px 40px;
            margin: 30px 0;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: #667eea;
        }

        .card-content {
            font-size: 4em;
            font-weight: bold;
            color: #333;
        }

        .card.flipped .card-content {
            font-size: 2em;
        }

        .answer {
            margin-top: 20px;
            font-size: 1.5em;
            color: #666;
            line-height: 1.8;
        }

        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-show {
            background: #17a2b8;
            color: white;
        }

        .btn-again {
            background: #dc3545;
            color: white;
        }

        .btn-hard {
            background: #fd7e14;
            color: white;
        }

        .btn-good {
            background: #28a745;
            color: white;
        }

        .btn-easy {
            background: #6f42c1;
            color: white;
        }

        .progress {
            margin-top: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-bar {
            height: 6px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }

        .reset-btn {
            margin-top: 20px;
            background: #6c757d;
            color: white;
            font-size: 0.9em;
            padding: 10px 20px;
        }

        .settings-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #6c757d;
            color: white;
            font-size: 0.9em;
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .settings-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .settings-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .settings-modal {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .settings-title {
            font-size: 1.5em;
            margin-bottom: 25px;
            color: #333;
            text-align: center;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .setting-label {
            font-weight: 500;
            color: #333;
        }

        .setting-description {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .toggle {
            position: relative;
            width: 50px;
            height: 24px;
            background: #ccc;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle.active {
            background: #667eea;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .toggle.active .toggle-slider {
            transform: translateX(26px);
        }

        .settings-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 25px;
        }

        .settings-buttons .btn {
            flex: 1;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <button class="settings-btn" onclick="openSettings()">‚öôÔ∏è Settings</button>
    
    <div class="container">
        <h1>üá∑üá∏ Serbian Cyrillic Flash Cards</h1>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="newCards">0</div>
                <div class="stat-label">New</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="learningCards">0</div>
                <div class="stat-label">Learning</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="reviewCards">0</div>
                <div class="stat-label">Review</div>
            </div>
        </div>

        <div class="progress">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <div class="card" id="card">
            <div class="card-content" id="cardContent">–ê</div>
            <div class="answer hidden" id="cardAnswer">
                <strong>Latin:</strong> A<br>
                <strong>Sound:</strong> /a/ (as in "father")
            </div>
        </div>

        <div class="buttons">
            <button class="btn btn-show" id="showBtn" onclick="showAnswer()">Show Answer</button>
            
            <div class="hidden" id="gradeButtons">
                <button class="btn btn-again" onclick="gradeCard(0)">Again</button>
                <button class="btn btn-hard" onclick="gradeCard(1)">Hard</button>
                <button class="btn btn-good" onclick="gradeCard(2)">Good</button>
                <button class="btn btn-easy" onclick="gradeCard(3)">Easy</button>
            </div>
        </div>

        <button class="btn reset-btn" onclick="resetProgress()">Reset All Progress</button>
    </div>

    <!-- Settings Screen -->
    <div class="settings-screen hidden" id="settingsScreen">
        <div class="settings-modal">
            <h2 class="settings-title">Settings</h2>
            
            <div class="setting-item">
                <div>
                    <div class="setting-label">Words Mode</div>
                    <div class="setting-description">Show common Serbian words instead of individual characters</div>
                </div>
                <div class="toggle" id="wordsToggle" onclick="toggleWords()">
                    <div class="toggle-slider"></div>
                </div>
            </div>

            <div class="settings-buttons">
                <button class="btn btn-good" onclick="closeSettings()">Done</button>
            </div>
        </div>
    </div>

    <script>
        // Serbian Cyrillic alphabet data
        const alphabet = [
            { cyrillic: '–ê', latin: 'A', sound: '/a/ (as in "father")' },
            { cyrillic: '–ë', latin: 'B', sound: '/b/ (as in "book")' },
            { cyrillic: '–í', latin: 'V', sound: '/v/ (as in "victory")' },
            { cyrillic: '–ì', latin: 'G', sound: '/g/ (as in "go")' },
            { cyrillic: '–î', latin: 'D', sound: '/d/ (as in "dog")' },
            { cyrillic: '–Ç', latin: 'ƒê', sound: '/d ë/ (soft "dj")' },
            { cyrillic: '–ï', latin: 'E', sound: '/e/ (as in "bed")' },
            { cyrillic: '–ñ', latin: '≈Ω', sound: '/ í/ (as in "measure")' },
            { cyrillic: '–ó', latin: 'Z', sound: '/z/ (as in "zebra")' },
            { cyrillic: '–ò', latin: 'I', sound: '/i/ (as in "machine")' },
            { cyrillic: '–à', latin: 'J', sound: '/j/ (as in "yes")' },
            { cyrillic: '–ö', latin: 'K', sound: '/k/ (as in "king")' },
            { cyrillic: '–õ', latin: 'L', sound: '/l/ (as in "love")' },
            { cyrillic: '–â', latin: 'Lj', sound: '/ é/ (like "million")' },
            { cyrillic: '–ú', latin: 'M', sound: '/m/ (as in "mother")' },
            { cyrillic: '–ù', latin: 'N', sound: '/n/ (as in "no")' },
            { cyrillic: '–ä', latin: 'Nj', sound: '/…≤/ (like "canyon")' },
            { cyrillic: '–û', latin: 'O', sound: '/o/ (as in "dog")' },
            { cyrillic: '–ü', latin: 'P', sound: '/p/ (as in "pen")' },
            { cyrillic: '–†', latin: 'R', sound: '/r/ (rolled R)' },
            { cyrillic: '–°', latin: 'S', sound: '/s/ (as in "sun")' },
            { cyrillic: '–¢', latin: 'T', sound: '/t/ (as in "top")' },
            { cyrillic: '–ã', latin: 'ƒÜ', sound: '/t…ï/ (soft "ch")' },
            { cyrillic: '–£', latin: 'U', sound: '/u/ (as in "boot")' },
            { cyrillic: '–§', latin: 'F', sound: '/f/ (as in "fun")' },
            { cyrillic: '–•', latin: 'H', sound: '/x/ (like German "ach")' },
            { cyrillic: '–¶', latin: 'C', sound: '/ts/ (as in "cats")' },
            { cyrillic: '–ß', latin: 'ƒå', sound: '/t É/ (as in "chair")' },
            { cyrillic: '–è', latin: 'D≈æ', sound: '/d í/ (as in "judge")' },
            { cyrillic: '–®', latin: '≈†', sound: '/ É/ (as in "shirt")' }
        ];

        // 100 common Serbian words
        const commonWords = [
            { cyrillic: '–±–∏—Ç–∏', latin: 'biti', meaning: 'to be' },
            { cyrillic: '–∏–º–∞—Ç–∏', latin: 'imati', meaning: 'to have' },
            { cyrillic: '–º–æ—õ–∏', latin: 'moƒái', meaning: 'to be able to' },
            { cyrillic: '—Ä–µ—õ–∏', latin: 'reƒái', meaning: 'to say' },
            { cyrillic: '—Ö—Ç–µ—Ç–∏', latin: 'hteti', meaning: 'to want' },
            { cyrillic: '–¥–æ—õ–∏', latin: 'doƒái', meaning: 'to come' },
            { cyrillic: '–∏—õ–∏', latin: 'iƒái', meaning: 'to go' },
            { cyrillic: '–∑–Ω–∞—Ç–∏', latin: 'znati', meaning: 'to know' },
            { cyrillic: '–≤–∏–¥–µ—Ç–∏', latin: 'videti', meaning: 'to see' },
            { cyrillic: '–¥–∞—Ç–∏', latin: 'dati', meaning: 'to give' },
            { cyrillic: '—á–æ–≤–µ–∫', latin: 'ƒçovek', meaning: 'person, man' },
            { cyrillic: '–∂–µ–Ω–∞', latin: '≈æena', meaning: 'woman' },
            { cyrillic: '–¥–µ—Ç–µ', latin: 'dete', meaning: 'child' },
            { cyrillic: '–∫—É—õ–∞', latin: 'kuƒáa', meaning: 'house' },
            { cyrillic: '–≤–æ–¥–∞', latin: 'voda', meaning: 'water' },
            { cyrillic: '–∑–µ–º—ô–∞', latin: 'zemlja', meaning: 'earth, country' },
            { cyrillic: '–Ω–µ–±–æ', latin: 'nebo', meaning: 'sky' },
            { cyrillic: '—Å—É–Ω—Ü–µ', latin: 'sunce', meaning: 'sun' },
            { cyrillic: '–º–µ—Å–µ—Ü', latin: 'mesec', meaning: 'moon, month' },
            { cyrillic: '–¥–∞–Ω', latin: 'dan', meaning: 'day' },
            { cyrillic: '–Ω–æ—õ', latin: 'noƒá', meaning: 'night' },
            { cyrillic: '–≤—Ä–µ–º–µ', latin: 'vreme', meaning: 'time, weather' },
            { cyrillic: '–≥–æ–¥–∏–Ω–∞', latin: 'godina', meaning: 'year' },
            { cyrillic: '–º–µ—Å—Ç–æ', latin: 'mesto', meaning: 'place' },
            { cyrillic: '—Ä—É–∫–∞', latin: 'ruka', meaning: 'hand, arm' },
            { cyrillic: '–Ω–æ–≥–∞', latin: 'noga', meaning: 'leg, foot' },
            { cyrillic: '–≥–ª–∞–≤–∞', latin: 'glava', meaning: 'head' },
            { cyrillic: '–æ–∫–æ', latin: 'oko', meaning: 'eye' },
            { cyrillic: '—Å—Ä—Ü–µ', latin: 'srce', meaning: 'heart' },
            { cyrillic: '—ô—É–±–∞–≤', latin: 'ljubav', meaning: 'love' },
            { cyrillic: '–ø—Ä–∏—ò–∞—Ç–µ—ô', latin: 'prijatelj', meaning: 'friend' },
            { cyrillic: '–ø–æ—Ä–æ–¥–∏—Ü–∞', latin: 'porodica', meaning: 'family' },
            { cyrillic: '–±—Ä–∞—Ç', latin: 'brat', meaning: 'brother' },
            { cyrillic: '—Å–µ—Å—Ç—Ä–∞', latin: 'sestra', meaning: 'sister' },
            { cyrillic: '–æ—Ç–∞—Ü', latin: 'otac', meaning: 'father' },
            { cyrillic: '–º–∞—ò–∫–∞', latin: 'majka', meaning: 'mother' },
            { cyrillic: '—Å–∏–Ω', latin: 'sin', meaning: 'son' },
            { cyrillic: '–∫—õ–µ—Ä–∫–∞', latin: 'kƒáerka', meaning: 'daughter' },
            { cyrillic: '—à–∫–æ–ª–∞', latin: '≈°kola', meaning: 'school' },
            { cyrillic: '–∫—ö–∏–≥–∞', latin: 'knjiga', meaning: 'book' },
            { cyrillic: '–ø–∏—Å–∞—Ç–∏', latin: 'pisati', meaning: 'to write' },
            { cyrillic: '—á–∏—Ç–∞—Ç–∏', latin: 'ƒçitati', meaning: 'to read' },
            { cyrillic: '—É—á–∏—Ç–∏', latin: 'uƒçiti', meaning: 'to learn' },
            { cyrillic: '—Ä–∞–¥–∏—Ç–∏', latin: 'raditi', meaning: 'to work' },
            { cyrillic: '–∏–≥—Ä–∞—Ç–∏', latin: 'igrati', meaning: 'to play' },
            { cyrillic: '–ø–µ–≤–∞—Ç–∏', latin: 'pevati', meaning: 'to sing' },
            { cyrillic: '—Å–ø–∞–≤–∞—Ç–∏', latin: 'spavati', meaning: 'to sleep' },
            { cyrillic: '—ò–µ—Å—Ç–∏', latin: 'jesti', meaning: 'to eat' },
            { cyrillic: '–ø–∏—Ç–∏', latin: 'piti', meaning: 'to drink' },
            { cyrillic: '–≥–æ–≤–æ—Ä–∏—Ç–∏', latin: 'govoriti', meaning: 'to speak' },
            { cyrillic: '—Å–ª—É—à–∞—Ç–∏', latin: 'slu≈°ati', meaning: 'to listen' },
            { cyrillic: '–º–∏—Å–ª–∏—Ç–∏', latin: 'misliti', meaning: 'to think' },
            { cyrillic: '–æ—Å–µ—õ–∞—Ç–∏', latin: 'oseƒáati', meaning: 'to feel' },
            { cyrillic: '–≤–æ–ª–µ—Ç–∏', latin: 'voleti', meaning: 'to love' },
            { cyrillic: '–∂–∏–≤–µ—Ç–∏', latin: '≈æiveti', meaning: 'to live' },
            { cyrillic: '—É–º—Ä–µ—Ç–∏', latin: 'umreti', meaning: 'to die' },
            { cyrillic: '—Ä–æ—í–µ—ö–µ', latin: 'roƒëenje', meaning: 'birth' },
            { cyrillic: '–∂–∏–≤–æ—Ç', latin: '≈æivot', meaning: 'life' },
            { cyrillic: '—Å–º—Ä—Ç', latin: 'smrt', meaning: 'death' },
            { cyrillic: '—Å—Ä–µ—õ–∞', latin: 'sreƒáa', meaning: 'happiness' },
            { cyrillic: '—Ç—É–≥–∞', latin: 'tuga', meaning: 'sadness' },
            { cyrillic: '—Å—Ç—Ä–∞—Ö', latin: 'strah', meaning: 'fear' },
            { cyrillic: '–Ω–∞–¥–∞', latin: 'nada', meaning: 'hope' },
            { cyrillic: '–º–∏—Ä', latin: 'mir', meaning: 'peace' },
            { cyrillic: '—Ä–∞—Ç', latin: 'rat', meaning: 'war' },
            { cyrillic: '–∑–¥—Ä–∞–≤—ô–µ', latin: 'zdravlje', meaning: 'health' },
            { cyrillic: '–±–æ–ª–µ—Å—Ç', latin: 'bolest', meaning: 'illness' },
            { cyrillic: '–ª–µ–∫–∞—Ä', latin: 'lekar', meaning: 'doctor' },
            { cyrillic: '–±–æ–ª–Ω–∏—Ü–∞', latin: 'bolnica', meaning: 'hospital' },
            { cyrillic: '–ª–µ–∫', latin: 'lek', meaning: 'medicine' },
            { cyrillic: '—Ö—Ä–∞–Ω–∞', latin: 'hrana', meaning: 'food' },
            { cyrillic: '—Ö–ª–µ–±', latin: 'hleb', meaning: 'bread' },
            { cyrillic: '–º–µ—Å–æ', latin: 'meso', meaning: 'meat' },
            { cyrillic: '—Ä–∏–±–∞', latin: 'riba', meaning: 'fish' },
            { cyrillic: '–≤–æ—õ–µ', latin: 'voƒáe', meaning: 'fruit' },
            { cyrillic: '–ø–æ–≤—Ä—õ–µ', latin: 'povrƒáe', meaning: 'vegetables' },
            { cyrillic: '–º–ª–µ–∫–æ', latin: 'mleko', meaning: 'milk' },
            { cyrillic: '—ò–∞—ò–µ', latin: 'jaje', meaning: 'egg' },
            { cyrillic: '—Å–∏—Ä', latin: 'sir', meaning: 'cheese' },
            { cyrillic: '—à–µ—õ–µ—Ä', latin: '≈°eƒáer', meaning: 'sugar' },
            { cyrillic: '—Å–æ', latin: 'so', meaning: 'salt' },
            { cyrillic: '–∫–∞—Ñ–∞', latin: 'kafa', meaning: 'coffee' },
            { cyrillic: '—á–∞—ò', latin: 'ƒçaj', meaning: 'tea' },
            { cyrillic: '–ø–∏–≤–æ', latin: 'pivo', meaning: 'beer' },
            { cyrillic: '–≤–∏–Ω–æ', latin: 'vino', meaning: 'wine' },
            { cyrillic: '–∞—É—Ç–æ–º–æ–±–∏–ª', latin: 'automobil', meaning: 'car' },
            { cyrillic: '–≤–æ–∑', latin: 'voz', meaning: 'train' },
            { cyrillic: '–∞–≤–∏–æ–Ω', latin: 'avion', meaning: 'airplane' },
            { cyrillic: '–±—Ä–æ–¥', latin: 'brod', meaning: 'ship' },
            { cyrillic: '–±–∏—Ü–∏–∫–ª', latin: 'bicikl', meaning: 'bicycle' },
            { cyrillic: '–ø—É—Ç', latin: 'put', meaning: 'road, journey' },
            { cyrillic: '–≥—Ä–∞–¥', latin: 'grad', meaning: 'city' },
            { cyrillic: '—Å–µ–ª–æ', latin: 'selo', meaning: 'village' },
            { cyrillic: '—Ä–µ–∫–∞', latin: 'reka', meaning: 'river' },
            { cyrillic: '–º–æ—Ä–µ', latin: 'more', meaning: 'sea' },
            { cyrillic: '–ø–ª–∞–Ω–∏–Ω–∞', latin: 'planina', meaning: 'mountain' },
            { cyrillic: '—à—É–º–∞', latin: '≈°uma', meaning: 'forest' },
            { cyrillic: '–¥—Ä–≤–æ', latin: 'drvo', meaning: 'tree' },
            { cyrillic: '—Ü–≤–µ—Ç', latin: 'cvet', meaning: 'flower' },
            { cyrillic: '—Ç—Ä–∞–≤–∞', latin: 'trava', meaning: 'grass' },
            { cyrillic: '–∂–∏–≤–æ—Ç–∏—ö–∞', latin: '≈æivotinja', meaning: 'animal' },
            { cyrillic: '–ø–∞—Å', latin: 'pas', meaning: 'dog' },
            { cyrillic: '–º–∞—á–∫–∞', latin: 'maƒçka', meaning: 'cat' },
            { cyrillic: '–∫–æ—ö', latin: 'konj', meaning: 'horse' },
            { cyrillic: '–ø—Ç–∏—Ü–∞', latin: 'ptica', meaning: 'bird' }
        ];

        // Anki SM-2 Algorithm implementation
        class Card {
            constructor(data, id) {
                this.id = id;
                this.data = data;
                this.easeFactor = 2.5;
                this.repetitions = 0;
                this.interval = 1;
                this.dueDate = new Date();
                this.isNew = true;
                this.isLearning = false;
            }

            grade(quality) {
                if (this.isNew) {
                    this.isNew = false;
                    this.isLearning = true;
                }

                if (quality < 2) {
                    this.repetitions = 0;
                    this.interval = 1;
                    this.isLearning = true;
                } else {
                    if (this.repetitions === 0) {
                        this.interval = 1;
                    } else if (this.repetitions === 1) {
                        this.interval = 6;
                    } else {
                        this.interval = Math.round(this.interval * this.easeFactor);
                    }

                    this.repetitions++;
                    this.easeFactor = this.easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
                    
                    if (this.easeFactor < 1.3) {
                        this.easeFactor = 1.3;
                    }

                    if (this.repetitions > 1) {
                        this.isLearning = false;
                    }
                }

                this.dueDate = new Date();
                this.dueDate.setDate(this.dueDate.getDate() + this.interval);
                this.save();
            }

            isDue() {
                return new Date() >= this.dueDate;
            }

            save() {
                const storageKey = this.storageKey || 'serbianCards';
                const cards = JSON.parse(localStorage.getItem(storageKey) || '{}');
                cards[this.id] = {
                    easeFactor: this.easeFactor,
                    repetitions: this.repetitions,
                    interval: this.interval,
                    dueDate: this.dueDate.toISOString(),
                    isNew: this.isNew,
                    isLearning: this.isLearning
                };
                localStorage.setItem(storageKey, JSON.stringify(cards));
            }

            static load(data, id, storageKey = 'serbianCards') {
                const cards = JSON.parse(localStorage.getItem(storageKey) || '{}');
                const card = new Card(data, id);
                card.storageKey = storageKey;
                
                if (cards[id]) {
                    const saved = cards[id];
                    card.easeFactor = saved.easeFactor;
                    card.repetitions = saved.repetitions;
                    card.interval = saved.interval;
                    card.dueDate = new Date(saved.dueDate);
                    card.isNew = saved.isNew;
                    card.isLearning = saved.isLearning;
                }
                
                return card;
            }
        }

        // Game state
        let cards = [];
        let currentCard = null;
        let isShowingAnswer = false;
        let wordsMode = false;

        // Settings management
        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('serbianSettings') || '{}');
            wordsMode = settings.wordsMode || false;
            updateSettingsUI();
        }

        function saveSettings() {
            const settings = { wordsMode };
            localStorage.setItem('serbianSettings', JSON.stringify(settings));
        }

        function updateSettingsUI() {
            const toggle = document.getElementById('wordsToggle');
            if (wordsMode) {
                toggle.classList.add('active');
            } else {
                toggle.classList.remove('active');
            }
        }

        // Initialize cards
        function initializeCards() {
            const dataSource = wordsMode ? commonWords : alphabet;
            const storageKey = wordsMode ? 'serbianWordsCards' : 'serbianCards';
            cards = dataSource.map((data, index) => Card.load(data, index, storageKey));
        }

        // Get next card to study
        function getNextCard() {
            const dueCards = cards.filter(card => card.isDue());
            const newCards = dueCards.filter(card => card.isNew);
            const learningCards = dueCards.filter(card => card.isLearning && !card.isNew);
            const reviewCards = dueCards.filter(card => !card.isNew && !card.isLearning);

            // Prioritize: learning cards, then new cards, then review cards
            if (learningCards.length > 0) {
                return learningCards[Math.floor(Math.random() * learningCards.length)];
            } else if (newCards.length > 0) {
                return newCards[Math.floor(Math.random() * newCards.length)];
            } else if (reviewCards.length > 0) {
                return reviewCards[Math.floor(Math.random() * reviewCards.length)];
            }

            return null;
        }

        // Update statistics
        function updateStats() {
            const dueCards = cards.filter(card => card.isDue());
            const newCount = dueCards.filter(card => card.isNew).length;
            const learningCount = dueCards.filter(card => card.isLearning && !card.isNew).length;
            const reviewCount = dueCards.filter(card => !card.isNew && !card.isLearning).length;

            document.getElementById('newCards').textContent = newCount;
            document.getElementById('learningCards').textContent = learningCount;
            document.getElementById('reviewCards').textContent = reviewCount;

            const totalStudied = cards.filter(card => !card.isNew).length;
            const progress = (totalStudied / cards.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        // Show next card
        function showNextCard() {
            currentCard = getNextCard();
            
            if (!currentCard) {
                document.getElementById('cardContent').textContent = 'üéâ All done for now!';
                document.getElementById('cardAnswer').classList.add('hidden');
                document.getElementById('showBtn').classList.add('hidden');
                document.getElementById('gradeButtons').classList.add('hidden');
                return;
            }

            document.getElementById('cardContent').textContent = currentCard.data.cyrillic;
            
            let answerHtml;
            if (wordsMode) {
                answerHtml = `<strong>Latin:</strong> ${currentCard.data.latin}<br>
                             <strong>Meaning:</strong> ${currentCard.data.meaning}`;
            } else {
                answerHtml = `<strong>Latin:</strong> ${currentCard.data.latin}<br>
                             <strong>Sound:</strong> ${currentCard.data.sound}`;
            }
            
            document.getElementById('cardAnswer').innerHTML = answerHtml;
            document.getElementById('cardAnswer').classList.add('hidden');
            document.getElementById('card').classList.remove('flipped');
            
            document.getElementById('showBtn').classList.remove('hidden');
            document.getElementById('gradeButtons').classList.add('hidden');
            
            isShowingAnswer = false;
        }

        // Show answer
        function showAnswer() {
            document.getElementById('cardAnswer').classList.remove('hidden');
            document.getElementById('card').classList.add('flipped');
            document.getElementById('showBtn').classList.add('hidden');
            document.getElementById('gradeButtons').classList.remove('hidden');
            isShowingAnswer = true;
        }

        // Grade card
        function gradeCard(quality) {
            if (!isShowingAnswer) return;
            
            currentCard.grade(quality);
            updateStats();
            showNextCard();
        }

        // Reset progress
        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
                localStorage.removeItem('serbianCards');
                localStorage.removeItem('serbianWordsCards');
                initializeCards();
                updateStats();
                showNextCard();
            }
        }

        // Settings functions
        function openSettings() {
            document.getElementById('settingsScreen').classList.remove('hidden');
        }

        function closeSettings() {
            document.getElementById('settingsScreen').classList.add('hidden');
        }

        function toggleWords() {
            wordsMode = !wordsMode;
            saveSettings();
            updateSettingsUI();
            initializeCards();
            updateStats();
            showNextCard();
        }

        // Initialize app
        loadSettings();
        initializeCards();
        updateStats();
        showNextCard();

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (!isShowingAnswer && e.code === 'Space') {
                e.preventDefault();
                showAnswer();
            } else if (isShowingAnswer) {
                switch(e.key) {
                    case '1':
                        gradeCard(0);
                        break;
                    case '2':
                        gradeCard(1);
                        break;
                    case '3':
                        gradeCard(2);
                        break;
                    case '4':
                        gradeCard(3);
                        break;
                }
            }
        });
    </script>
</body>
</html>