<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyrillinki</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üá∑üá∏</text></svg>">
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Cyrillinki">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 fill=%22%23667eea%22 rx=%2220%22/><text x=%2250%22 y=%2270%22 font-size=%2260%22 text-anchor=%22middle%22>üá∑üá∏</text></svg>">
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
    <style>
        /* Import Inter font for professional typography */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

        /* CSS Custom Properties for Theme System */
        :root {
            /* Professional Light Theme with Serbian accent colors */
            --bg-primary: linear-gradient(135deg, #fafafa 0%, #f0f0f0 100%);
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --bg-accent: rgba(248, 249, 250, 0.8);
            --text-primary: #1a1a1a;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            --accent-primary: #c41e3a; /* Serbian red */
            --accent-secondary: #0056b3; /* Serbian blue */
            --accent-tertiary: #6366f1; /* Playful purple */
            --border-color: rgba(226, 232, 240, 0.8);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.05), 0 2px 4px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.08), 0 6px 10px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.1), 0 10px 20px rgba(0, 0, 0, 0.06);
            --progress-bg: rgba(226, 232, 240, 0.4);
            --progress-fill: linear-gradient(135deg, #c41e3a 0%, #0056b3 50%, #6366f1 100%);
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        .dark {
            /* Professional Dark Theme */
            --bg-primary: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
            --bg-secondary: #1f1f1f;
            --bg-card: rgba(30, 30, 30, 0.9);
            --bg-accent: rgba(40, 40, 40, 0.8);
            --text-primary: #f7fafc;
            --text-secondary: #cbd5e0;
            --text-muted: #a0aec0;
            --accent-primary: #ef4444; /* Bright red */
            --accent-secondary: #3b82f6; /* Bright blue */
            --accent-tertiary: #8b5cf6; /* Purple */
            --border-color: rgba(75, 85, 99, 0.3);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.2), 0 1px 2px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.3), 0 2px 4px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.4), 0 6px 10px rgba(0, 0, 0, 0.3);
            --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.5), 0 10px 20px rgba(0, 0, 0, 0.4);
            --progress-bg: rgba(75, 85, 99, 0.3);
            --progress-fill: linear-gradient(135deg, #ef4444 0%, #3b82f6 50%, #8b5cf6 100%);
            --glass-bg: rgba(30, 30, 30, 0.7);
            --glass-border: rgba(75, 85, 99, 0.2);
        }

        .vibe {
            /* Cyberpunk Theme */
            --bg-primary: linear-gradient(135deg, #0a0e27 0%, #151937 100%);
            --bg-secondary: #1a1f3a;
            --bg-card: rgba(26, 31, 58, 0.9);
            --bg-accent: rgba(30, 36, 66, 0.8);
            --text-primary: #00ffff;
            --text-secondary: #ff00ff;
            --text-muted: #00ff88;
            --accent-primary: #ff0080;
            --accent-secondary: #00ffff;
            --accent-tertiary: #ffff00;
            --border-color: rgba(0, 255, 255, 0.3);
            --shadow-sm: 0 1px 3px rgba(0, 255, 255, 0.1), 0 1px 2px rgba(255, 0, 255, 0.1);
            --shadow-md: 0 4px 6px rgba(0, 255, 255, 0.15), 0 2px 4px rgba(255, 0, 255, 0.1);
            --shadow-lg: 0 10px 25px rgba(0, 255, 255, 0.2), 0 6px 10px rgba(255, 0, 255, 0.15);
            --shadow-xl: 0 20px 40px rgba(0, 255, 255, 0.3), 0 10px 20px rgba(255, 0, 255, 0.2);
            --progress-bg: rgba(0, 255, 255, 0.1);
            --progress-fill: linear-gradient(135deg, #ff0080 0%, #00ffff 33%, #ffff00 66%, #ff00ff 100%);
            --glass-bg: rgba(26, 31, 58, 0.7);
            --glass-border: rgba(0, 255, 255, 0.2);
        }

        /* Global styles */
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        /* Smooth transitions for all theme changes */
        body, .card-container, .stats-container, .settings-modal {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Animation for vibe theme */
        .vibe {
            animation: vibeGlow 4s ease-in-out infinite alternate;
        }

        @keyframes vibeGlow {
            0% { filter: hue-rotate(0deg) brightness(1); }
            50% { filter: hue-rotate(180deg) brightness(1.1); }
            100% { filter: hue-rotate(360deg) brightness(1); }
        }

        /* Card entrance animation */
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card-content {
            animation: slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Button hover effects */
        .btn {
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        /* Glassmorphism effect for cards */
        .glass {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        /* Progress bar pulse animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .progress-animated {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* Card flip animation */
        .card-flip {
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card-flip.flipped {
            transform: rotateY(180deg);
        }

        /* Smooth fade animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Keyboard shortcut hints */
        .kbd {
            display: inline-block;
            padding: 2px 6px;
            font-size: 11px;
            font-weight: 600;
            line-height: 1;
            color: var(--text-muted);
            background: var(--bg-accent);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            box-shadow: 0 1px 0 var(--border-color);
            font-family: monospace;
        }

        /* Toggle switch styles */
        .toggle {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .toggle::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .toggle:hover::before {
            transform: translateX(100%);
        }

        .toggle.active .toggle-slider {
            transform: translateX(24px);
        }

        .toggle.active {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)) !important;
        }

        .toggle-slider {
            box-shadow: var(--shadow-sm);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .toggle.active .toggle-slider {
            box-shadow: var(--shadow-md);
        }

        /* Progress bar animation for vibe theme */
        .vibe #progressBar {
            background: var(--progress-fill);
            background-size: 200% 100%;
            animation: progressShimmer 2s linear infinite;
        }

        @keyframes progressShimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Settings modal slide animation */
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .settings-modal.show {
            animation: slideDown 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Enhanced mobile responsiveness */
        @media (max-width: 640px) {
            .btn {
                min-height: 48px; /* Better touch targets */
            }

            .toggle {
                min-width: 52px;
                min-height: 28px;
            }

            .kbd {
                display: none; /* Hide keyboard hints on mobile */
            }
        }

        /* Reduce motion for accessibility */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body class="font-sans min-h-screen flex justify-center items-center p-4 sm:p-6 overflow-hidden touch-none transition-all duration-500" style="background: var(--bg-primary);">
    <div class="rounded-[24px] max-w-[520px] w-full p-6 sm:p-10 text-center max-h-screen overflow-y-auto overscroll-none transition-all duration-500 glass" style="background: var(--glass-bg); box-shadow: var(--shadow-xl); border: 1px solid var(--glass-border); backdrop-filter: blur(10px);">
        <div class="relative mb-10">
            <h1 class="text-4xl font-bold text-center tracking-tight" style="color: var(--text-primary); text-shadow: 0 2px 4px rgba(0,0,0,0.1);">üá∑üá∏ Cyrillinki</h1>
            <p class="text-sm mt-2 opacity-80" style="color: var(--text-muted);">Master Serbian Cyrillic with Spaced Repetition</p>
            <button class="absolute top-0 right-0 bg-transparent border-0 text-2xl cursor-pointer transition-all duration-300 p-2 rounded-full hover:scale-110" style="background: var(--bg-accent); box-shadow: var(--shadow-sm);" onmouseover="this.style.transform='scale(1.1) rotate(90deg)'" onmouseout="this.style.transform='scale(1) rotate(0deg)'" onclick="openSettings()">‚öôÔ∏è</button>
            <div class="text-xs text-center mt-3 font-semibold px-3 py-1 rounded-full inline-block hidden" style="background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); color: white;" id="practiceModeIndicator">üìö Practice Mode Active</div>
        </div>
        
        <div class="relative mb-10 rounded-[16px] transition-all duration-500 overflow-hidden stats-container" style="background: var(--bg-accent); box-shadow: var(--shadow-md); border: 1px solid var(--border-color);">
            <div class="flex justify-around p-6">
                <div class="text-center transition-all duration-300 hover:scale-105">
                    <div class="text-3xl font-bold mb-1" style="color: var(--accent-primary);" id="newCards">0</div>
                    <div class="text-xs font-semibold uppercase tracking-wider opacity-80" style="color: var(--text-muted);">New</div>
                </div>
                <div class="text-center transition-all duration-300 hover:scale-105">
                    <div class="text-3xl font-bold mb-1" style="color: var(--accent-secondary);" id="learningCards">0</div>
                    <div class="text-xs font-semibold uppercase tracking-wider opacity-80" style="color: var(--text-muted);">Learning</div>
                </div>
                <div class="text-center transition-all duration-300 hover:scale-105">
                    <div class="text-3xl font-bold mb-1" style="color: var(--accent-tertiary);" id="reviewCards">0</div>
                    <div class="text-xs font-semibold uppercase tracking-wider opacity-80" style="color: var(--text-muted);">Review</div>
                </div>
            </div>
            <!-- Progress bar -->
            <div class="relative h-2" style="background: var(--progress-bg);">
                <div class="h-full transition-all duration-700 ease-out progress-animated rounded-r" style="background: var(--progress-fill);" id="progressBar"></div>
            </div>
        </div>
        <div class="text-sm text-center -mt-8 mb-8 font-semibold" style="color: var(--text-secondary);" id="progressText">0% mastered</div>

        <div class="rounded-[20px] px-6 sm:px-12 py-12 sm:py-16 my-6 sm:my-10 min-h-[180px] sm:min-h-[240px] flex flex-col items-center justify-center transition-all duration-500 card-container card-content" style="background: linear-gradient(135deg, var(--bg-accent), var(--bg-secondary)); box-shadow: var(--shadow-lg); border: 1px solid var(--border-color); position: relative; overflow: hidden;" id="card">
            <!-- Decorative gradient overlay -->
            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, transparent 0%, rgba(255,255,255,0.05) 50%, transparent 100%); pointer-events: none;"></div>
            <div class="text-[7em] sm:text-[10em] font-bold [.flipped_&]:text-[4em] sm:[.flipped_&]:text-[5em] break-all text-center leading-tight transition-all duration-500 relative z-10" style="color: var(--text-primary); font-family: 'Georgia', 'Times New Roman', serif; word-wrap: break-word; overflow-wrap: break-word; max-width: 100%; text-shadow: 0 2px 8px rgba(0,0,0,0.1);" id="cardContent">–ê</div>
            <div class="hidden mt-6 text-2xl leading-[1.8] relative z-10" style="color: var(--text-secondary);" id="cardAnswer">
                <strong class="font-semibold">A</strong><br>
                <span class="text-sm opacity-90">/a/ (as in "father")</span>
            </div>
        </div>

        <div class="flex gap-3 sm:gap-4 justify-center mt-6 sm:mt-10 flex-wrap">
            <button class="btn px-6 sm:px-8 py-3.5 sm:py-4 border-0 rounded-[12px] text-sm sm:text-base font-semibold cursor-pointer transition-all duration-300 min-w-[100px] sm:min-w-[120px] text-white transform hover:-translate-y-1" style="background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); box-shadow: var(--shadow-md);" id="showBtn" onclick="showAnswer()">Show Answer</button>
            
            <div class="hidden gap-3 sm:gap-4 flex-wrap" id="gradeButtons">
                <button class="btn px-4 sm:px-6 py-3 sm:py-4 border-0 rounded-[12px] text-xs sm:text-base font-semibold cursor-pointer transition-all duration-300 min-w-[70px] sm:min-w-[100px] text-white transform hover:-translate-y-1" style="background: linear-gradient(135deg, #ef4444, #dc2626); box-shadow: var(--shadow-md);" onclick="gradeCard(0)">Again</button>
                <button class="btn px-4 sm:px-6 py-3 sm:py-4 border-0 rounded-[12px] text-xs sm:text-base font-semibold cursor-pointer transition-all duration-300 min-w-[70px] sm:min-w-[100px] text-white transform hover:-translate-y-1" style="background: linear-gradient(135deg, #f97316, #ea580c); box-shadow: var(--shadow-md);" onclick="gradeCard(1)">Hard</button>
                <button class="btn px-4 sm:px-6 py-3 sm:py-4 border-0 rounded-[12px] text-xs sm:text-base font-semibold cursor-pointer transition-all duration-300 min-w-[70px] sm:min-w-[100px] text-white transform hover:-translate-y-1" style="background: linear-gradient(135deg, #22c55e, #16a34a); box-shadow: var(--shadow-md);" onclick="gradeCard(2)">Good</button>
                <button class="btn px-4 sm:px-6 py-3 sm:py-4 border-0 rounded-[12px] text-xs sm:text-base font-semibold cursor-pointer transition-all duration-300 min-w-[70px] sm:min-w-[100px] text-white transform hover:-translate-y-1" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); box-shadow: var(--shadow-md);" onclick="gradeCard(3)">Easy</button>
            </div>
        </div>

    </div>

    <!-- Settings Screen -->
    <div class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden flex justify-center items-center z-[1000] p-4 transition-all duration-300" id="settingsScreen">
        <div class="rounded-[24px] max-w-[420px] w-full transition-all duration-500 max-h-[90vh] flex flex-col settings-modal glass" style="background: var(--glass-bg); box-shadow: var(--shadow-xl); border: 1px solid var(--glass-border); backdrop-filter: blur(20px);">
            <div class="p-8 pb-4">
                <h2 class="text-2xl font-bold mb-2 text-center" style="color: var(--text-primary);">Settings</h2>
                <p class="text-sm text-center opacity-70" style="color: var(--text-muted);">Customize your learning experience</p>
            </div>
            
            <!-- Scrollable content -->
            <div class="flex-1 overflow-y-auto px-8">
            
            <div class="flex justify-between items-center mb-5 p-5 rounded-[16px] transition-all duration-300 hover:scale-[1.02]" style="background: var(--bg-accent); box-shadow: var(--shadow-sm); border: 1px solid var(--border-color);">
                <div>
                    <div class="font-semibold" style="color: var(--text-primary);">Theme</div>
                    <div class="text-xs mt-1 opacity-80" style="color: var(--text-muted);">Choose your preferred color scheme</div>
                </div>
                <select class="rounded-[10px] px-4 py-2.5 text-sm font-medium focus:outline-none focus:ring-2 transition-all duration-300 cursor-pointer" style="background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary); box-shadow: var(--shadow-sm); --tw-ring-color: var(--accent-primary);" id="themeSelect" onchange="changeTheme()">
                    <option value="auto">üåì Auto</option>
                    <option value="light">‚òÄÔ∏è Light</option>
                    <option value="dark">üåô Dark</option>
                </select>
            </div>
            
            <div class="flex justify-between items-center mb-5 p-5 rounded-[16px] transition-all duration-300 hover:scale-[1.02]" style="background: var(--bg-accent); box-shadow: var(--shadow-sm); border: 1px solid var(--border-color);">
                <div class="flex-1 mr-4">
                    <div class="font-semibold" style="color: var(--text-primary);">Words Mode</div>
                    <div class="text-xs mt-1 opacity-80" style="color: var(--text-muted);">Learn common Serbian words instead of individual letters</div>
                </div>
                <div class="relative w-[52px] h-[28px] rounded-full cursor-pointer transition-all duration-300 toggle" style="background: linear-gradient(135deg, #cbd5e0, #a0aec0);" id="wordsToggle" onclick="toggleWords()">
                    <div class="absolute top-[3px] left-[3px] w-[22px] h-[22px] bg-white rounded-full transition-all duration-300 toggle-slider"></div>
                </div>
            </div>

            <div class="flex justify-between items-center mb-5 p-5 rounded-[16px] transition-all duration-300 hover:scale-[1.02]" style="background: var(--bg-accent); box-shadow: var(--shadow-sm); border: 1px solid var(--border-color);">
                <div class="flex-1 mr-4">
                    <div class="font-semibold" style="color: var(--text-primary);">Practice Mode</div>
                    <div class="text-xs mt-1 opacity-80" style="color: var(--text-muted);">Review all cards without waiting for intervals</div>
                </div>
                <div class="relative w-[52px] h-[28px] rounded-full cursor-pointer transition-all duration-300 toggle" style="background: linear-gradient(135deg, #cbd5e0, #a0aec0);" id="practiceToggle" onclick="togglePracticeMode()">
                    <div class="absolute top-[3px] left-[3px] w-[22px] h-[22px] bg-white rounded-full transition-all duration-300 toggle-slider"></div>
                </div>
            </div>

            <!-- Detailed Statistics -->
            <div class="mb-6 p-5 rounded-[16px] transition-all duration-300" style="background: var(--bg-accent); box-shadow: var(--shadow-sm); border: 1px solid var(--border-color);">
                <h3 class="font-semibold mb-4 text-sm uppercase tracking-wider" style="color: var(--text-primary);">üìä Learning Statistics</h3>
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between items-center p-2 rounded-lg transition-all duration-200 hover:bg-black/5 dark:hover:bg-white/5">
                        <span style="color: var(--text-muted);">Total Cards</span>
                        <span class="font-semibold" style="color: var(--text-primary);" id="statsTotalCards">0</span>
                    </div>
                    <div class="flex justify-between items-center p-2 rounded-lg transition-all duration-200 hover:bg-black/5 dark:hover:bg-white/5">
                        <span style="color: var(--text-muted);">Studied Cards</span>
                        <span class="font-semibold" style="color: var(--text-primary);" id="statsStudiedCards">0</span>
                    </div>
                    <div class="flex justify-between items-center p-2 rounded-lg transition-all duration-200 hover:bg-black/5 dark:hover:bg-white/5">
                        <span style="color: var(--text-muted);">Mature Cards (21+ days)</span>
                        <span class="font-semibold" style="color: var(--accent-secondary);" id="statsMatureCards">0</span>
                    </div>
                    <div class="flex justify-between items-center p-2 rounded-lg transition-all duration-200 hover:bg-black/5 dark:hover:bg-white/5">
                        <span style="color: var(--text-muted);">Young Cards (&lt;21 days)</span>
                        <span class="font-semibold" style="color: var(--accent-primary);" id="statsYoungCards">0</span>
                    </div>
                    <div class="flex justify-between items-center p-2 rounded-lg transition-all duration-200 hover:bg-black/5 dark:hover:bg-white/5">
                        <span style="color: var(--text-muted);">Average Ease Factor</span>
                        <span class="font-semibold" style="color: var(--text-primary);" id="statsAverageEase">2.50</span>
                    </div>
                    <div class="flex justify-between items-center p-2 rounded-lg transition-all duration-200 hover:bg-black/5 dark:hover:bg-white/5">
                        <span style="color: var(--text-muted);">Retention Rate</span>
                        <span class="font-semibold" style="color: var(--accent-secondary);" id="statsRetentionRate">100%</span>
                    </div>
                    <div class="flex justify-between items-center p-3 mt-3 rounded-lg" style="background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); opacity: 0.1;">
                        <span class="font-semibold" style="color: var(--text-primary); opacity: 1;">üèÜ Mastery Progress</span>
                        <span class="font-bold text-lg" style="color: var(--accent-primary); opacity: 1;" id="statsMasteryProgress">0%</span>
                    </div>
                </div>
            </div>
            
            <!-- Reset Progress Button -->
            <div class="px-8 pb-4">
                <button class="btn w-full text-white text-sm px-5 py-3 border-0 rounded-[12px] font-semibold cursor-pointer transition-all duration-300 transform hover:scale-[1.02]" style="background: linear-gradient(135deg, #ef4444, #dc2626); box-shadow: var(--shadow-md);" onclick="resetProgress()">‚ö†Ô∏è Reset All Progress</button>
            </div>
            </div>

            <!-- Fixed Done Button -->
            <div class="p-8 pt-4" style="border-top: 1px solid var(--border-color);">
                <button class="btn w-full px-6 py-4 border-0 rounded-[12px] text-base font-semibold cursor-pointer transition-all duration-300 text-white transform hover:scale-[1.02]" style="background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); box-shadow: var(--shadow-md);" onclick="closeSettings()">‚úì Done</button>
            </div>
        </div>
    </div>

    <script>
        // Serbian Cyrillic alphabet data
        const alphabet = [
            { cyrillic: '–ê', latin: 'A', sound: '/a/ (as in "father")' },
            { cyrillic: '–ë', latin: 'B', sound: '/b/ (as in "book")' },
            { cyrillic: '–í', latin: 'V', sound: '/v/ (as in "victory")' },
            { cyrillic: '–ì', latin: 'G', sound: '/g/ (as in "go")' },
            { cyrillic: '–î', latin: 'D', sound: '/d/ (as in "dog")' },
            { cyrillic: '–Ç', latin: 'ƒê', sound: '/d ë/ (soft "dj")' },
            { cyrillic: '–ï', latin: 'E', sound: '/e/ (as in "bed")' },
            { cyrillic: '–ñ', latin: '≈Ω', sound: '/ í/ (as in "measure")' },
            { cyrillic: '–ó', latin: 'Z', sound: '/z/ (as in "zebra")' },
            { cyrillic: '–ò', latin: 'I', sound: '/i/ (as in "machine")' },
            { cyrillic: '–à', latin: 'J', sound: '/j/ (as in "yes")' },
            { cyrillic: '–ö', latin: 'K', sound: '/k/ (as in "king")' },
            { cyrillic: '–õ', latin: 'L', sound: '/l/ (as in "love")' },
            { cyrillic: '–â', latin: 'Lj', sound: '/ é/ (like "million")' },
            { cyrillic: '–ú', latin: 'M', sound: '/m/ (as in "mother")' },
            { cyrillic: '–ù', latin: 'N', sound: '/n/ (as in "no")' },
            { cyrillic: '–ä', latin: 'Nj', sound: '/…≤/ (like "canyon")' },
            { cyrillic: '–û', latin: 'O', sound: '/o/ (as in "dog")' },
            { cyrillic: '–ü', latin: 'P', sound: '/p/ (as in "pen")' },
            { cyrillic: '–†', latin: 'R', sound: '/r/ (rolled R)' },
            { cyrillic: '–°', latin: 'S', sound: '/s/ (as in "sun")' },
            { cyrillic: '–¢', latin: 'T', sound: '/t/ (as in "top")' },
            { cyrillic: '–ã', latin: 'ƒÜ', sound: '/t…ï/ (soft "ch")' },
            { cyrillic: '–£', latin: 'U', sound: '/u/ (as in "boot")' },
            { cyrillic: '–§', latin: 'F', sound: '/f/ (as in "fun")' },
            { cyrillic: '–•', latin: 'H', sound: '/x/ (like German "ach")' },
            { cyrillic: '–¶', latin: 'C', sound: '/ts/ (as in "cats")' },
            { cyrillic: '–ß', latin: 'ƒå', sound: '/t É/ (as in "chair")' },
            { cyrillic: '–è', latin: 'D≈æ', sound: '/d í/ (as in "judge")' },
            { cyrillic: '–®', latin: '≈†', sound: '/ É/ (as in "shirt")' }
        ];

        // 100 common Serbian words
        const commonWords = [
            { cyrillic: '–±–∏—Ç–∏', latin: 'biti', meaning: 'to be' },
            { cyrillic: '–∏–º–∞—Ç–∏', latin: 'imati', meaning: 'to have' },
            { cyrillic: '–º–æ—õ–∏', latin: 'moƒái', meaning: 'to be able to' },
            { cyrillic: '—Ä–µ—õ–∏', latin: 'reƒái', meaning: 'to say' },
            { cyrillic: '—Ö—Ç–µ—Ç–∏', latin: 'hteti', meaning: 'to want' },
            { cyrillic: '–¥–æ—õ–∏', latin: 'doƒái', meaning: 'to come' },
            { cyrillic: '–∏—õ–∏', latin: 'iƒái', meaning: 'to go' },
            { cyrillic: '–∑–Ω–∞—Ç–∏', latin: 'znati', meaning: 'to know' },
            { cyrillic: '–≤–∏–¥–µ—Ç–∏', latin: 'videti', meaning: 'to see' },
            { cyrillic: '–¥–∞—Ç–∏', latin: 'dati', meaning: 'to give' },
            { cyrillic: '—á–æ–≤–µ–∫', latin: 'ƒçovek', meaning: 'person, man' },
            { cyrillic: '–∂–µ–Ω–∞', latin: '≈æena', meaning: 'woman' },
            { cyrillic: '–¥–µ—Ç–µ', latin: 'dete', meaning: 'child' },
            { cyrillic: '–∫—É—õ–∞', latin: 'kuƒáa', meaning: 'house' },
            { cyrillic: '–≤–æ–¥–∞', latin: 'voda', meaning: 'water' },
            { cyrillic: '–∑–µ–º—ô–∞', latin: 'zemlja', meaning: 'earth, country' },
            { cyrillic: '–Ω–µ–±–æ', latin: 'nebo', meaning: 'sky' },
            { cyrillic: '—Å—É–Ω—Ü–µ', latin: 'sunce', meaning: 'sun' },
            { cyrillic: '–º–µ—Å–µ—Ü', latin: 'mesec', meaning: 'moon, month' },
            { cyrillic: '–¥–∞–Ω', latin: 'dan', meaning: 'day' },
            { cyrillic: '–Ω–æ—õ', latin: 'noƒá', meaning: 'night' },
            { cyrillic: '–≤—Ä–µ–º–µ', latin: 'vreme', meaning: 'time, weather' },
            { cyrillic: '–≥–æ–¥–∏–Ω–∞', latin: 'godina', meaning: 'year' },
            { cyrillic: '–º–µ—Å—Ç–æ', latin: 'mesto', meaning: 'place' },
            { cyrillic: '—Ä—É–∫–∞', latin: 'ruka', meaning: 'hand, arm' },
            { cyrillic: '–Ω–æ–≥–∞', latin: 'noga', meaning: 'leg, foot' },
            { cyrillic: '–≥–ª–∞–≤–∞', latin: 'glava', meaning: 'head' },
            { cyrillic: '–æ–∫–æ', latin: 'oko', meaning: 'eye' },
            { cyrillic: '—Å—Ä—Ü–µ', latin: 'srce', meaning: 'heart' },
            { cyrillic: '—ô—É–±–∞–≤', latin: 'ljubav', meaning: 'love' },
            { cyrillic: '–ø—Ä–∏—ò–∞—Ç–µ—ô', latin: 'prijatelj', meaning: 'friend' },
            { cyrillic: '–ø–æ—Ä–æ–¥–∏—Ü–∞', latin: 'porodica', meaning: 'family' },
            { cyrillic: '–±—Ä–∞—Ç', latin: 'brat', meaning: 'brother' },
            { cyrillic: '—Å–µ—Å—Ç—Ä–∞', latin: 'sestra', meaning: 'sister' },
            { cyrillic: '–æ—Ç–∞—Ü', latin: 'otac', meaning: 'father' },
            { cyrillic: '–º–∞—ò–∫–∞', latin: 'majka', meaning: 'mother' },
            { cyrillic: '—Å–∏–Ω', latin: 'sin', meaning: 'son' },
            { cyrillic: '–∫—õ–µ—Ä–∫–∞', latin: 'kƒáerka', meaning: 'daughter' },
            { cyrillic: '—à–∫–æ–ª–∞', latin: '≈°kola', meaning: 'school' },
            { cyrillic: '–∫—ö–∏–≥–∞', latin: 'knjiga', meaning: 'book' },
            { cyrillic: '–ø–∏—Å–∞—Ç–∏', latin: 'pisati', meaning: 'to write' },
            { cyrillic: '—á–∏—Ç–∞—Ç–∏', latin: 'ƒçitati', meaning: 'to read' },
            { cyrillic: '—É—á–∏—Ç–∏', latin: 'uƒçiti', meaning: 'to learn' },
            { cyrillic: '—Ä–∞–¥–∏—Ç–∏', latin: 'raditi', meaning: 'to work' },
            { cyrillic: '–∏–≥—Ä–∞—Ç–∏', latin: 'igrati', meaning: 'to play' },
            { cyrillic: '–ø–µ–≤–∞—Ç–∏', latin: 'pevati', meaning: 'to sing' },
            { cyrillic: '—Å–ø–∞–≤–∞—Ç–∏', latin: 'spavati', meaning: 'to sleep' },
            { cyrillic: '—ò–µ—Å—Ç–∏', latin: 'jesti', meaning: 'to eat' },
            { cyrillic: '–ø–∏—Ç–∏', latin: 'piti', meaning: 'to drink' },
            { cyrillic: '–≥–æ–≤–æ—Ä–∏—Ç–∏', latin: 'govoriti', meaning: 'to speak' },
            { cyrillic: '—Å–ª—É—à–∞—Ç–∏', latin: 'slu≈°ati', meaning: 'to listen' },
            { cyrillic: '–º–∏—Å–ª–∏—Ç–∏', latin: 'misliti', meaning: 'to think' },
            { cyrillic: '–æ—Å–µ—õ–∞—Ç–∏', latin: 'oseƒáati', meaning: 'to feel' },
            { cyrillic: '–≤–æ–ª–µ—Ç–∏', latin: 'voleti', meaning: 'to love' },
            { cyrillic: '–∂–∏–≤–µ—Ç–∏', latin: '≈æiveti', meaning: 'to live' },
            { cyrillic: '—É–º—Ä–µ—Ç–∏', latin: 'umreti', meaning: 'to die' },
            { cyrillic: '—Ä–æ—í–µ—ö–µ', latin: 'roƒëenje', meaning: 'birth' },
            { cyrillic: '–∂–∏–≤–æ—Ç', latin: '≈æivot', meaning: 'life' },
            { cyrillic: '—Å–º—Ä—Ç', latin: 'smrt', meaning: 'death' },
            { cyrillic: '—Å—Ä–µ—õ–∞', latin: 'sreƒáa', meaning: 'happiness' },
            { cyrillic: '—Ç—É–≥–∞', latin: 'tuga', meaning: 'sadness' },
            { cyrillic: '—Å—Ç—Ä–∞—Ö', latin: 'strah', meaning: 'fear' },
            { cyrillic: '–Ω–∞–¥–∞', latin: 'nada', meaning: 'hope' },
            { cyrillic: '–º–∏—Ä', latin: 'mir', meaning: 'peace' },
            { cyrillic: '—Ä–∞—Ç', latin: 'rat', meaning: 'war' },
            { cyrillic: '–∑–¥—Ä–∞–≤—ô–µ', latin: 'zdravlje', meaning: 'health' },
            { cyrillic: '–±–æ–ª–µ—Å—Ç', latin: 'bolest', meaning: 'illness' },
            { cyrillic: '–ª–µ–∫–∞—Ä', latin: 'lekar', meaning: 'doctor' },
            { cyrillic: '–±–æ–ª–Ω–∏—Ü–∞', latin: 'bolnica', meaning: 'hospital' },
            { cyrillic: '–ª–µ–∫', latin: 'lek', meaning: 'medicine' },
            { cyrillic: '—Ö—Ä–∞–Ω–∞', latin: 'hrana', meaning: 'food' },
            { cyrillic: '—Ö–ª–µ–±', latin: 'hleb', meaning: 'bread' },
            { cyrillic: '–º–µ—Å–æ', latin: 'meso', meaning: 'meat' },
            { cyrillic: '—Ä–∏–±–∞', latin: 'riba', meaning: 'fish' },
            { cyrillic: '–≤–æ—õ–µ', latin: 'voƒáe', meaning: 'fruit' },
            { cyrillic: '–ø–æ–≤—Ä—õ–µ', latin: 'povrƒáe', meaning: 'vegetables' },
            { cyrillic: '–º–ª–µ–∫–æ', latin: 'mleko', meaning: 'milk' },
            { cyrillic: '—ò–∞—ò–µ', latin: 'jaje', meaning: 'egg' },
            { cyrillic: '—Å–∏—Ä', latin: 'sir', meaning: 'cheese' },
            { cyrillic: '—à–µ—õ–µ—Ä', latin: '≈°eƒáer', meaning: 'sugar' },
            { cyrillic: '—Å–æ', latin: 'so', meaning: 'salt' },
            { cyrillic: '–∫–∞—Ñ–∞', latin: 'kafa', meaning: 'coffee' },
            { cyrillic: '—á–∞—ò', latin: 'ƒçaj', meaning: 'tea' },
            { cyrillic: '–ø–∏–≤–æ', latin: 'pivo', meaning: 'beer' },
            { cyrillic: '–≤–∏–Ω–æ', latin: 'vino', meaning: 'wine' },
            { cyrillic: '–∞—É—Ç–æ–º–æ–±–∏–ª', latin: 'automobil', meaning: 'car' },
            { cyrillic: '–≤–æ–∑', latin: 'voz', meaning: 'train' },
            { cyrillic: '–∞–≤–∏–æ–Ω', latin: 'avion', meaning: 'airplane' },
            { cyrillic: '–±—Ä–æ–¥', latin: 'brod', meaning: 'ship' },
            { cyrillic: '–±–∏—Ü–∏–∫–ª', latin: 'bicikl', meaning: 'bicycle' },
            { cyrillic: '–ø—É—Ç', latin: 'put', meaning: 'road, journey' },
            { cyrillic: '–≥—Ä–∞–¥', latin: 'grad', meaning: 'city' },
            { cyrillic: '—Å–µ–ª–æ', latin: 'selo', meaning: 'village' },
            { cyrillic: '—Ä–µ–∫–∞', latin: 'reka', meaning: 'river' },
            { cyrillic: '–º–æ—Ä–µ', latin: 'more', meaning: 'sea' },
            { cyrillic: '–ø–ª–∞–Ω–∏–Ω–∞', latin: 'planina', meaning: 'mountain' },
            { cyrillic: '—à—É–º–∞', latin: '≈°uma', meaning: 'forest' },
            { cyrillic: '–¥—Ä–≤–æ', latin: 'drvo', meaning: 'tree' },
            { cyrillic: '—Ü–≤–µ—Ç', latin: 'cvet', meaning: 'flower' },
            { cyrillic: '—Ç—Ä–∞–≤–∞', latin: 'trava', meaning: 'grass' },
            { cyrillic: '–∂–∏–≤–æ—Ç–∏—ö–∞', latin: '≈æivotinja', meaning: 'animal' },
            { cyrillic: '–ø–∞—Å', latin: 'pas', meaning: 'dog' },
            { cyrillic: '–º–∞—á–∫–∞', latin: 'maƒçka', meaning: 'cat' },
            { cyrillic: '–∫–æ—ö', latin: 'konj', meaning: 'horse' },
            { cyrillic: '–ø—Ç–∏—Ü–∞', latin: 'ptica', meaning: 'bird' }
        ];

        // Anki SM-2 Algorithm implementation
        class Card {
            constructor(data, id) {
                this.id = id;
                this.data = data;
                this.easeFactor = 2.5;
                this.repetitions = 0;
                this.interval = 1;
                this.dueDate = new Date();
                this.isNew = true;
                this.isLearning = false;
            }

            grade(quality) {
                if (this.isNew) {
                    this.isNew = false;
                    this.isLearning = true;
                }

                if (quality < 2) {
                    this.repetitions = 0;
                    this.interval = 1;
                    this.isLearning = true;
                } else {
                    if (this.repetitions === 0) {
                        this.interval = 1;
                    } else if (this.repetitions === 1) {
                        this.interval = 6;
                    } else {
                        this.interval = Math.round(this.interval * this.easeFactor);
                    }

                    this.repetitions++;
                    this.easeFactor = this.easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
                    
                    if (this.easeFactor < 1.3) {
                        this.easeFactor = 1.3;
                    }

                    if (this.repetitions > 1) {
                        this.isLearning = false;
                    }
                }

                this.dueDate = new Date();
                this.dueDate.setDate(this.dueDate.getDate() + this.interval);
                this.save();
            }

            isDue() {
                return new Date() >= this.dueDate;
            }

            save() {
                const storageKey = this.storageKey || 'serbianCards';
                const cards = JSON.parse(localStorage.getItem(storageKey) || '{}');
                cards[this.id] = {
                    easeFactor: this.easeFactor,
                    repetitions: this.repetitions,
                    interval: this.interval,
                    dueDate: this.dueDate.toISOString(),
                    isNew: this.isNew,
                    isLearning: this.isLearning
                };
                localStorage.setItem(storageKey, JSON.stringify(cards));
            }

            static load(data, id, storageKey = 'serbianCards') {
                const cards = JSON.parse(localStorage.getItem(storageKey) || '{}');
                const card = new Card(data, id);
                card.storageKey = storageKey;
                
                if (cards[id]) {
                    const saved = cards[id];
                    card.easeFactor = saved.easeFactor;
                    card.repetitions = saved.repetitions;
                    card.interval = saved.interval;
                    card.dueDate = new Date(saved.dueDate);
                    card.isNew = saved.isNew;
                    card.isLearning = saved.isLearning;
                }
                
                return card;
            }
        }

        // Game state
        let cards = [];
        let currentCard = null;
        let isShowingAnswer = false;
        let wordsMode = false;
        let practiceMode = false;
        let theme = 'auto';

        // Theme management
        function applyTheme(themeValue) {
            // Check for vibe mode
            const isVibeMode = window.location.hash === '#vibe';
            
            if (isVibeMode) {
                document.documentElement.classList.add('vibe');
                document.documentElement.classList.remove('dark');
                return;
            } else {
                document.documentElement.classList.remove('vibe');
            }
            
            if (themeValue === 'auto') {
                // Use system preference
                if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            } else if (themeValue === 'dark') {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }
        
        // Listen for hash changes to toggle vibe mode
        window.addEventListener('hashchange', function() {
            applyTheme(theme);
        });

        function changeTheme() {
            const select = document.getElementById('themeSelect');
            theme = select.value;
            applyTheme(theme);
            saveSettings();
        }

        // Listen for system theme changes when in auto mode
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
            if (theme === 'auto') {
                applyTheme('auto');
            }
        });

        // Settings management
        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('serbianSettings') || '{}');
            wordsMode = settings.wordsMode || false;
            practiceMode = settings.practiceMode || false;
            theme = settings.theme || 'auto';
            applyTheme(theme);
            updateSettingsUI();
        }

        function saveSettings() {
            const settings = { wordsMode, practiceMode, theme };
            localStorage.setItem('serbianSettings', JSON.stringify(settings));
        }

        function updateSettingsUI() {
            const wordsToggle = document.getElementById('wordsToggle');
            if (wordsMode) {
                wordsToggle.classList.add('active');
            } else {
                wordsToggle.classList.remove('active');
            }
            
            const practiceToggle = document.getElementById('practiceToggle');
            const practiceModeIndicator = document.getElementById('practiceModeIndicator');
            if (practiceMode) {
                practiceToggle.classList.add('active');
                practiceModeIndicator.classList.remove('hidden');
            } else {
                practiceToggle.classList.remove('active');
                practiceModeIndicator.classList.add('hidden');
            }
            
            const themeSelect = document.getElementById('themeSelect');
            themeSelect.value = theme;
        }

        // Initialize cards
        function initializeCards() {
            const dataSource = wordsMode ? commonWords : alphabet;
            const storageKey = wordsMode ? 'serbianWordsCards' : 'serbianCards';
            cards = dataSource.map((data, index) => Card.load(data, index, storageKey));
        }

        // Get next card to study
        function getNextCard() {
            // In practice mode, show all cards that have been studied at least once
            if (practiceMode) {
                const studiedCards = cards.filter(card => !card.isNew);
                if (studiedCards.length > 0) {
                    return studiedCards[Math.floor(Math.random() * studiedCards.length)];
                }
                // If no cards have been studied yet, fall back to new cards
                const newCards = cards.filter(card => card.isNew);
                if (newCards.length > 0) {
                    return newCards[Math.floor(Math.random() * newCards.length)];
                }
                return null;
            }
            
            // Normal mode: only show due cards
            const dueCards = cards.filter(card => card.isDue());
            const newCards = dueCards.filter(card => card.isNew);
            const learningCards = dueCards.filter(card => card.isLearning && !card.isNew);
            const reviewCards = dueCards.filter(card => !card.isNew && !card.isLearning);

            // Prioritize: learning cards, then new cards, then review cards
            if (learningCards.length > 0) {
                return learningCards[Math.floor(Math.random() * learningCards.length)];
            } else if (newCards.length > 0) {
                return newCards[Math.floor(Math.random() * newCards.length)];
            } else if (reviewCards.length > 0) {
                return reviewCards[Math.floor(Math.random() * reviewCards.length)];
            }

            return null;
        }

        // Calculate advanced statistics
        function calculateStats() {
            // In practice mode, show all cards as available
            if (practiceMode) {
                const newCount = cards.filter(card => card.isNew).length;
                const learningCount = cards.filter(card => card.isLearning && !card.isNew).length;
                const reviewCount = cards.filter(card => !card.isNew && !card.isLearning).length;
                
                // Continue with rest of function using all cards
                const totalCards = cards.length;
                const studiedCards = cards.filter(card => !card.isNew);
                const matureCards = cards.filter(card => card.interval >= 21 && !card.isNew && !card.isLearning);
                const youngCards = studiedCards.filter(card => card.interval < 21);
                const averageEase = studiedCards.length > 0 ? 
                    studiedCards.reduce((sum, card) => sum + card.easeFactor, 0) / studiedCards.length : 2.5;
                const retentionRate = studiedCards.length > 0 ? 
                    (studiedCards.filter(card => card.easeFactor >= 2.5).length / studiedCards.length) * 100 : 100;
                
                return {
                    newCount,
                    learningCount, 
                    reviewCount,
                    totalCards,
                    studiedCards: studiedCards.length,
                    matureCards: matureCards.length,
                    youngCards: youngCards.length,
                    averageEase: Math.round(averageEase * 100) / 100,
                    retentionRate: Math.round(retentionRate),
                    masteryProgress: Math.round((matureCards.length / totalCards) * 100)
                };
            }
            
            // Normal mode: only count due cards
            const dueCards = cards.filter(card => card.isDue());
            const newCount = dueCards.filter(card => card.isNew).length;
            const learningCount = dueCards.filter(card => card.isLearning && !card.isNew).length;
            const reviewCount = dueCards.filter(card => !card.isNew && !card.isLearning).length;
            
            // Advanced metrics
            const totalCards = cards.length;
            const studiedCards = cards.filter(card => !card.isNew);
            const matureCards = cards.filter(card => card.interval >= 21 && !card.isNew && !card.isLearning);
            const youngCards = studiedCards.filter(card => card.interval < 21);
            const averageEase = studiedCards.length > 0 ? 
                studiedCards.reduce((sum, card) => sum + card.easeFactor, 0) / studiedCards.length : 2.5;
            const retentionRate = studiedCards.length > 0 ? 
                (studiedCards.filter(card => card.easeFactor >= 2.5).length / studiedCards.length) * 100 : 100;
            
            return {
                newCount,
                learningCount, 
                reviewCount,
                totalCards,
                studiedCards: studiedCards.length,
                matureCards: matureCards.length,
                youngCards: youngCards.length,
                averageEase: Math.round(averageEase * 100) / 100,
                retentionRate: Math.round(retentionRate),
                masteryProgress: Math.round((matureCards.length / totalCards) * 100)
            };
        }

        // Update statistics
        function updateStats() {
            const stats = calculateStats();

            document.getElementById('newCards').textContent = stats.newCount;
            document.getElementById('learningCards').textContent = stats.learningCount;
            document.getElementById('reviewCards').textContent = stats.reviewCount;

            // Update progress bar to show mastery progress
            document.getElementById('progressBar').style.width = stats.masteryProgress + '%';
            document.getElementById('progressText').textContent = `${stats.masteryProgress}% mastered`;
            
            // Update detailed statistics in settings
            document.getElementById('statsTotalCards').textContent = stats.totalCards;
            document.getElementById('statsStudiedCards').textContent = stats.studiedCards;
            document.getElementById('statsMatureCards').textContent = stats.matureCards;
            document.getElementById('statsYoungCards').textContent = stats.youngCards;
            document.getElementById('statsAverageEase').textContent = stats.averageEase.toFixed(2);
            document.getElementById('statsRetentionRate').textContent = stats.retentionRate + '%';
            document.getElementById('statsMasteryProgress').textContent = stats.masteryProgress + '%';
        }

        // Show next card
        function showNextCard() {
            currentCard = getNextCard();

            if (!currentCard) {
                document.getElementById('cardContent').textContent = 'üéâ';
                document.getElementById('cardAnswer').classList.add('hidden');
                document.getElementById('showBtn').innerHTML = 'Enable practice mode';
                document.getElementById('showBtn').onclick = function() {
                    practiceMode = true;
                    saveSettings();
                    updateSettingsUI();
                    updateStats();
                    showNextCard();
                };
                document.getElementById('showBtn').classList.remove('hidden');
                const gradeButtons = document.getElementById('gradeButtons');
                gradeButtons.classList.add('hidden');
                gradeButtons.classList.remove('flex');
                return;
            }

            const cardContent = document.getElementById('cardContent');
            cardContent.textContent = currentCard.data.cyrillic;

            // Adjust font size for words mode based on text length
            if (wordsMode) {
                const textLength = currentCard.data.cyrillic.length;
                cardContent.className = cardContent.className.replace(/text-\[[^\]]+\]/g, '');

                if (textLength <= 4) {
                    cardContent.className += ' text-[7em] sm:text-[10em] [.flipped_&]:text-[4em] sm:[.flipped_&]:text-[5em]';
                } else if (textLength <= 6) {
                    cardContent.className += ' text-[5em] sm:text-[7em] [.flipped_&]:text-[3em] sm:[.flipped_&]:text-[4em]';
                } else if (textLength <= 8) {
                    cardContent.className += ' text-[4em] sm:text-[5.5em] [.flipped_&]:text-[2.5em] sm:[.flipped_&]:text-[3.5em]';
                } else if (textLength <= 10) {
                    cardContent.className += ' text-[3em] sm:text-[4.5em] [.flipped_&]:text-[2em] sm:[.flipped_&]:text-[3em]';
                } else {
                    cardContent.className += ' text-[2.5em] sm:text-[3.5em] [.flipped_&]:text-[1.8em] sm:[.flipped_&]:text-[2.5em]';
                }
            } else {
                // Reset to original alphabet mode sizes
                cardContent.className = cardContent.className.replace(/text-\[[^\]]+\]/g, '');
                cardContent.className += ' text-[7em] sm:text-[10em] [.flipped_&]:text-[4em] sm:[.flipped_&]:text-[5em]';
            }
            
            let answerHtml;
            if (wordsMode) {
                answerHtml = `<strong>${currentCard.data.latin}</strong><br>
                             <strong>Meaning:</strong> ${currentCard.data.meaning}`;
            } else {
                answerHtml = `<strong>${currentCard.data.latin}</strong><br>
                             <span class="text-sm">${currentCard.data.sound}</span>`;
            }
            
            document.getElementById('cardAnswer').innerHTML = answerHtml;
            document.getElementById('cardAnswer').classList.add('hidden');
            document.getElementById('card').classList.remove('flipped');
            
            // Reset show button to original state with keyboard hint
            document.getElementById('showBtn').innerHTML = 'Show Answer <span class="kbd">Space</span>';
            document.getElementById('showBtn').onclick = showAnswer;
            document.getElementById('showBtn').classList.remove('hidden');
            const gradeButtons = document.getElementById('gradeButtons');
            gradeButtons.classList.add('hidden');
            gradeButtons.classList.remove('flex');
            
            isShowingAnswer = false;
        }

        // Show answer
        function showAnswer() {
            const cardAnswer = document.getElementById('cardAnswer');
            cardAnswer.classList.remove('hidden');
            cardAnswer.classList.add('fade-in');
            document.getElementById('card').classList.add('flipped');
            document.getElementById('showBtn').classList.add('hidden');
            const gradeButtons = document.getElementById('gradeButtons');
            gradeButtons.classList.remove('hidden');
            gradeButtons.classList.add('flex');

            // Add keyboard hints to grade buttons
            const buttons = gradeButtons.querySelectorAll('button');
            const hints = ['1', '2', '3', '4'];
            const texts = ['Again', 'Hard', 'Good', 'Easy'];
            buttons.forEach((btn, i) => {
                if (!btn.innerHTML.includes('kbd')) {
                    btn.innerHTML = `${texts[i]} <span class="kbd">${hints[i]}</span>`;
                }
            });

            isShowingAnswer = true;
        }

        // Grade card
        function gradeCard(quality) {
            if (!isShowingAnswer) return;

            // Add visual feedback to clicked button
            const buttons = document.querySelectorAll('#gradeButtons button');
            const clickedButton = buttons[quality];
            if (clickedButton) {
                clickedButton.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    clickedButton.style.transform = '';
                }, 150);
            }

            currentCard.grade(quality);
            updateStats();
            showNextCard();
        }

        // Reset progress
        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
                localStorage.removeItem('serbianCards');
                localStorage.removeItem('serbianWordsCards');
                initializeCards();
                updateStats();
                showNextCard();
            }
        }

        // Settings functions
        function openSettings() {
            document.getElementById('settingsScreen').classList.remove('hidden');
        }

        function closeSettings() {
            const settingsScreen = document.getElementById('settingsScreen');
            const modal = settingsScreen.querySelector('.settings-modal');
            modal.classList.remove('show');
            setTimeout(() => {
                settingsScreen.classList.add('hidden');
            }, 200);
        }

        // Close settings when clicking outside the modal
        document.getElementById('settingsScreen').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSettings();
            }
        });

        function toggleWords() {
            wordsMode = !wordsMode;
            saveSettings();
            updateSettingsUI();
            initializeCards();
            updateStats();
            showNextCard();
        }
        
        function togglePracticeMode() {
            practiceMode = !practiceMode;
            saveSettings();
            updateSettingsUI();
            updateStats();
            showNextCard();
        }

        // Initialize app
        loadSettings();
        initializeCards();
        updateStats();
        showNextCard();

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (!isShowingAnswer && e.code === 'Space') {
                e.preventDefault();
                showAnswer();
            } else if (isShowingAnswer) {
                switch(e.key) {
                    case '1':
                        gradeCard(0);
                        break;
                    case '2':
                        gradeCard(1);
                        break;
                    case '3':
                        gradeCard(2);
                        break;
                    case '4':
                        gradeCard(3);
                        break;
                }
            }
        });
    </script>
</body>
</html>