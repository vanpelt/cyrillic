<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyrillinki</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üá∑üá∏</text></svg>">
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Cyrillinki">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 fill=%22%23667eea%22 rx=%2220%22/><text x=%2250%22 y=%2270%22 font-size=%2260%22 text-anchor=%22middle%22>üá∑üá∏</text></svg>">
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
    <style>
        /* CSS Custom Properties for Theme System */
        :root {
            /* Default Grayscale Light Theme */
            --bg-primary: #f8fafc;
            --bg-secondary: #f1f5f9;
            --bg-card: #ffffff;
            --bg-accent: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --accent-primary: #475569;
            --accent-secondary: #64748b;
            --border-color: #cbd5e1;
            --shadow-color: rgba(15, 23, 42, 0.1);
            --progress-bg: #e2e8f0;
            --progress-fill: linear-gradient(90deg, #475569, #64748b);
        }

        .dark {
            /* Grayscale Dark Theme */
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #334155;
            --bg-accent: #475569;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --accent-primary: #cbd5e1;
            --accent-secondary: #94a3b8;
            --border-color: #475569;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --progress-bg: #475569;
            --progress-fill: linear-gradient(90deg, #cbd5e1, #94a3b8);
        }

        .vibe {
            /* Sci-Fi Colorful Theme */
            --bg-primary: #0a0a0f;
            --bg-secondary: #1a1a2e;
            --bg-card: #16213e;
            --bg-accent: #0f3460;
            --text-primary: #00f5ff;
            --text-secondary: #ff6b6b;
            --text-muted: #4ecdc4;
            --accent-primary: #ff6b6b;
            --accent-secondary: #4ecdc4;
            --border-color: #00f5ff;
            --shadow-color: rgba(0, 245, 255, 0.2);
            --progress-bg: #1a1a2e;
            --progress-fill: linear-gradient(90deg, #ff6b6b, #4ecdc4, #00f5ff, #ff6b6b);
        }

        /* Animation for vibe theme */
        .vibe {
            animation: vibeGlow 3s ease-in-out infinite alternate;
        }

        @keyframes vibeGlow {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(60deg); }
        }

        /* Only keep styles that can't be replaced with Tailwind */
        .toggle.active .toggle-slider {
            transform: translateX(26px);
        }
        
        .toggle.active {
            background: var(--accent-primary) !important;
        }

        /* Progress bar animation for vibe theme */
        .vibe #progressBar {
            background: var(--progress-fill);
            background-size: 200% 100%;
            animation: progressShimmer 2s linear infinite;
        }

        @keyframes progressShimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body class="font-sans min-h-screen flex justify-center items-center p-2 sm:p-5 overflow-hidden touch-none transition-colors duration-300" style="background: var(--bg-primary);">
    <div class="rounded-[20px] max-w-[500px] w-full p-5 sm:p-10 text-center max-h-screen overflow-y-auto overscroll-none transition-colors duration-300" style="background: var(--bg-card); box-shadow: 0 20px 40px var(--shadow-color);">
        <div class="relative mb-8">
            <h1 class="text-3xl text-center" style="color: var(--text-primary);">üá∑üá∏ Cyrillinki</h1>
            <button class="absolute top-0 right-0 bg-transparent border-0 text-2xl cursor-pointer transition-all p-1 hover:scale-125 hover:opacity-70" onclick="openSettings()">‚öôÔ∏è</button>
            <div class="text-xs text-center mt-2 font-medium hidden" style="color: var(--accent-secondary);" id="practiceModeIndicator">üìö Practice Mode Active</div>
        </div>
        
        <div class="relative mb-8 rounded-[10px] transition-colors duration-300 overflow-hidden" style="background: var(--bg-accent);">
            <div class="flex justify-around p-5">
                <div class="text-center">
                    <div class="text-2xl font-bold" style="color: var(--accent-primary);" id="newCards">0</div>
                    <div class="text-sm mt-1" style="color: var(--text-muted);">New</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold" style="color: var(--accent-primary);" id="learningCards">0</div>
                    <div class="text-sm mt-1" style="color: var(--text-muted);">Learning</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold" style="color: var(--accent-primary);" id="reviewCards">0</div>
                    <div class="text-sm mt-1" style="color: var(--text-muted);">Review</div>
                </div>
            </div>
            <!-- Progress bar as bottom border -->
            <div class="absolute bottom-0 left-0 w-full h-1" style="background: var(--progress-bg);">
                <div class="h-full transition-[width] duration-300 ease-in-out" style="background: var(--progress-fill);" id="progressBar"></div>
            </div>
        </div>
        <div class="text-xs text-center -mt-6 mb-6" style="color: var(--text-muted);" id="progressText">0% mastered</div>

        <div class="rounded-[15px] px-5 sm:px-10 py-10 sm:py-[60px] my-4 sm:my-8 min-h-[150px] sm:min-h-[200px] flex flex-col items-center justify-center border-2 transition-all duration-300" style="background: var(--bg-accent); border-color: var(--border-color);" onmouseover="this.style.borderColor='var(--accent-primary)'" onmouseout="this.style.borderColor='var(--border-color)'" id="card">
            <div class="text-[7em] sm:text-[10em] font-bold [.flipped_&]:text-[4em] sm:[.flipped_&]:text-[5em]" style="color: var(--text-primary); font-family: 'Times New Roman', 'Liberation Serif', 'DejaVu Serif', Georgia, serif;" id="cardContent">–ê</div>
            <div class="hidden mt-5 text-2xl leading-[1.8]" style="color: var(--text-secondary);" id="cardAnswer">
                <strong>Latin:</strong> A<br>
                <span class="text-xs">/a/ (as in "father")</span>
            </div>
        </div>

        <div class="flex gap-2 sm:gap-4 justify-center mt-4 sm:mt-8 flex-wrap">
            <button class="px-4 sm:px-6 py-3 sm:py-4 border-0 rounded-[10px] text-sm sm:text-base font-semibold cursor-pointer transition-all duration-300 min-w-[80px] sm:min-w-[100px] text-white hover:-translate-y-0.5 hover:shadow-[0_5px_15px_rgba(0,0,0,0.2)]" style="background: var(--accent-secondary);" id="showBtn" onclick="showAnswer()">Show Answer</button>
            
            <div class="hidden gap-2 sm:gap-4 flex-wrap" id="gradeButtons">
                <button class="px-3 sm:px-6 py-2.5 sm:py-4 border-0 rounded-[10px] text-xs sm:text-base font-semibold cursor-pointer transition-all duration-300 min-w-[60px] sm:min-w-[100px] bg-red-600 text-white hover:-translate-y-0.5 hover:shadow-[0_5px_15px_rgba(0,0,0,0.2)]" onclick="gradeCard(0)">Again</button>
                <button class="px-3 sm:px-6 py-2.5 sm:py-4 border-0 rounded-[10px] text-xs sm:text-base font-semibold cursor-pointer transition-all duration-300 min-w-[60px] sm:min-w-[100px] bg-orange-500 text-white hover:-translate-y-0.5 hover:shadow-[0_5px_15px_rgba(0,0,0,0.2)]" onclick="gradeCard(1)">Hard</button>
                <button class="px-3 sm:px-6 py-2.5 sm:py-4 border-0 rounded-[10px] text-xs sm:text-base font-semibold cursor-pointer transition-all duration-300 min-w-[60px] sm:min-w-[100px] bg-green-600 text-white hover:-translate-y-0.5 hover:shadow-[0_5px_15px_rgba(0,0,0,0.2)]" onclick="gradeCard(2)">Good</button>
                <button class="px-3 sm:px-6 py-2.5 sm:py-4 border-0 rounded-[10px] text-xs sm:text-base font-semibold cursor-pointer transition-all duration-300 min-w-[60px] sm:min-w-[100px] bg-purple-600 text-white hover:-translate-y-0.5 hover:shadow-[0_5px_15px_rgba(0,0,0,0.2)]" onclick="gradeCard(3)">Easy</button>
            </div>
        </div>

    </div>

    <!-- Settings Screen -->
    <div class="fixed inset-0 bg-black/50 hidden flex justify-center items-center z-[1000] p-4" id="settingsScreen">
        <div class="rounded-[15px] max-w-[400px] w-full transition-colors duration-300 max-h-[90vh] flex flex-col" style="background: var(--bg-card); box-shadow: 0 20px 40px var(--shadow-color);">
            <div class="p-8 pb-4">
                <h2 class="text-2xl mb-6 text-center" style="color: var(--text-primary);">Settings</h2>
            </div>
            
            <!-- Scrollable content -->
            <div class="flex-1 overflow-y-auto px-8">
            
            <div class="flex justify-between items-center mb-5 p-4 rounded-[10px] transition-colors duration-300" style="background: var(--bg-accent);">
                <div>
                    <div class="font-medium" style="color: var(--text-primary);">Theme</div>
                    <div class="text-sm mt-1" style="color: var(--text-muted);">Choose your preferred color scheme</div>
                </div>
                <select class="rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 transition-colors duration-300" style="background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary); --tw-ring-color: var(--accent-primary);" id="themeSelect" onchange="changeTheme()">
                    <option value="auto">Auto</option>
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                </select>
            </div>
            
            <div class="flex justify-between items-center mb-5 p-4 rounded-[10px] transition-colors duration-300" style="background: var(--bg-accent);">
                <div>
                    <div class="font-medium" style="color: var(--text-primary);">Words Mode</div>
                    <div class="text-sm mt-1" style="color: var(--text-muted);">Show common Serbian words instead of individual characters</div>
                </div>
                <div class="relative w-[50px] h-6 rounded-full cursor-pointer transition-colors duration-300 toggle" style="background: var(--text-muted);" id="wordsToggle" onclick="toggleWords()">
                    <div class="absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full transition-transform duration-300 toggle-slider"></div>
                </div>
            </div>

            <div class="flex justify-between items-center mb-5 p-4 rounded-[10px] transition-colors duration-300" style="background: var(--bg-accent);">
                <div>
                    <div class="font-medium" style="color: var(--text-primary);">Practice Mode</div>
                    <div class="text-sm mt-1" style="color: var(--text-muted);">Review all cards without waiting for intervals</div>
                </div>
                <div class="relative w-[50px] h-6 rounded-full cursor-pointer transition-colors duration-300 toggle" style="background: var(--text-muted);" id="practiceToggle" onclick="togglePracticeMode()">
                    <div class="absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full transition-transform duration-300 toggle-slider"></div>
                </div>
            </div>

            <!-- Detailed Statistics -->
            <div class="mb-6 p-4 rounded-[10px] transition-colors duration-300" style="background: var(--bg-accent);">
                <h3 class="font-medium mb-3" style="color: var(--text-primary);">Learning Statistics</h3>
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between">
                        <span style="color: var(--text-muted);">Total Cards:</span>
                        <span class="font-medium" style="color: var(--text-primary);" id="statsTotalCards">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span style="color: var(--text-muted);">Studied Cards:</span>
                        <span class="font-medium" style="color: var(--text-primary);" id="statsStudiedCards">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span style="color: var(--text-muted);">Mature Cards (21+ days):</span>
                        <span class="font-medium" style="color: var(--accent-secondary);" id="statsMatureCards">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span style="color: var(--text-muted);">Young Cards (&lt;21 days):</span>
                        <span class="font-medium" style="color: var(--accent-primary);" id="statsYoungCards">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span style="color: var(--text-muted);">Average Ease Factor:</span>
                        <span class="font-medium" style="color: var(--text-primary);" id="statsAverageEase">2.50</span>
                    </div>
                    <div class="flex justify-between">
                        <span style="color: var(--text-muted);">Retention Rate:</span>
                        <span class="font-medium" style="color: var(--accent-secondary);" id="statsRetentionRate">100%</span>
                    </div>
                    <div class="flex justify-between pt-2 mt-2" style="border-top: 1px solid var(--border-color);">
                        <span class="font-medium" style="color: var(--text-muted);">Mastery Progress:</span>
                        <span class="font-bold" style="color: var(--accent-primary);" id="statsMasteryProgress">0%</span>
                    </div>
                </div>
            </div>
            
            <!-- Reset Progress Button -->
            <div class="px-8 pb-4">
                <button class="w-full text-white text-sm px-5 py-3 border-0 rounded-[10px] font-semibold cursor-pointer transition-all duration-300 hover:-translate-y-0.5 hover:shadow-[0_5px_15px_rgba(0,0,0,0.2)]" style="background: #dc2626;" onmouseover="this.style.background='#b91c1c'" onmouseout="this.style.background='#dc2626'" onclick="resetProgress()">Reset All Progress</button>
            </div>
            </div>

            <!-- Fixed Done Button -->
            <div class="p-8 pt-4" style="border-top: 1px solid var(--border-color);">
                <button class="w-full px-6 py-4 border-0 rounded-[10px] text-base font-semibold cursor-pointer transition-all duration-300 text-white hover:-translate-y-0.5 hover:shadow-[0_5px_15px_rgba(0,0,0,0.2)]" style="background: var(--accent-secondary);" onclick="closeSettings()">Done</button>
            </div>
        </div>
    </div>

    <script>
        // Serbian Cyrillic alphabet data
        const alphabet = [
            { cyrillic: '–ê', latin: 'A', sound: '/a/ (as in "father")' },
            { cyrillic: '–ë', latin: 'B', sound: '/b/ (as in "book")' },
            { cyrillic: '–í', latin: 'V', sound: '/v/ (as in "victory")' },
            { cyrillic: '–ì', latin: 'G', sound: '/g/ (as in "go")' },
            { cyrillic: '–î', latin: 'D', sound: '/d/ (as in "dog")' },
            { cyrillic: '–Ç', latin: 'ƒê', sound: '/d ë/ (soft "dj")' },
            { cyrillic: '–ï', latin: 'E', sound: '/e/ (as in "bed")' },
            { cyrillic: '–ñ', latin: '≈Ω', sound: '/ í/ (as in "measure")' },
            { cyrillic: '–ó', latin: 'Z', sound: '/z/ (as in "zebra")' },
            { cyrillic: '–ò', latin: 'I', sound: '/i/ (as in "machine")' },
            { cyrillic: '–à', latin: 'J', sound: '/j/ (as in "yes")' },
            { cyrillic: '–ö', latin: 'K', sound: '/k/ (as in "king")' },
            { cyrillic: '–õ', latin: 'L', sound: '/l/ (as in "love")' },
            { cyrillic: '–â', latin: 'Lj', sound: '/ é/ (like "million")' },
            { cyrillic: '–ú', latin: 'M', sound: '/m/ (as in "mother")' },
            { cyrillic: '–ù', latin: 'N', sound: '/n/ (as in "no")' },
            { cyrillic: '–ä', latin: 'Nj', sound: '/…≤/ (like "canyon")' },
            { cyrillic: '–û', latin: 'O', sound: '/o/ (as in "dog")' },
            { cyrillic: '–ü', latin: 'P', sound: '/p/ (as in "pen")' },
            { cyrillic: '–†', latin: 'R', sound: '/r/ (rolled R)' },
            { cyrillic: '–°', latin: 'S', sound: '/s/ (as in "sun")' },
            { cyrillic: '–¢', latin: 'T', sound: '/t/ (as in "top")' },
            { cyrillic: '–ã', latin: 'ƒÜ', sound: '/t…ï/ (soft "ch")' },
            { cyrillic: '–£', latin: 'U', sound: '/u/ (as in "boot")' },
            { cyrillic: '–§', latin: 'F', sound: '/f/ (as in "fun")' },
            { cyrillic: '–•', latin: 'H', sound: '/x/ (like German "ach")' },
            { cyrillic: '–¶', latin: 'C', sound: '/ts/ (as in "cats")' },
            { cyrillic: '–ß', latin: 'ƒå', sound: '/t É/ (as in "chair")' },
            { cyrillic: '–è', latin: 'D≈æ', sound: '/d í/ (as in "judge")' },
            { cyrillic: '–®', latin: '≈†', sound: '/ É/ (as in "shirt")' }
        ];

        // 100 common Serbian words
        const commonWords = [
            { cyrillic: '–±–∏—Ç–∏', latin: 'biti', meaning: 'to be' },
            { cyrillic: '–∏–º–∞—Ç–∏', latin: 'imati', meaning: 'to have' },
            { cyrillic: '–º–æ—õ–∏', latin: 'moƒái', meaning: 'to be able to' },
            { cyrillic: '—Ä–µ—õ–∏', latin: 'reƒái', meaning: 'to say' },
            { cyrillic: '—Ö—Ç–µ—Ç–∏', latin: 'hteti', meaning: 'to want' },
            { cyrillic: '–¥–æ—õ–∏', latin: 'doƒái', meaning: 'to come' },
            { cyrillic: '–∏—õ–∏', latin: 'iƒái', meaning: 'to go' },
            { cyrillic: '–∑–Ω–∞—Ç–∏', latin: 'znati', meaning: 'to know' },
            { cyrillic: '–≤–∏–¥–µ—Ç–∏', latin: 'videti', meaning: 'to see' },
            { cyrillic: '–¥–∞—Ç–∏', latin: 'dati', meaning: 'to give' },
            { cyrillic: '—á–æ–≤–µ–∫', latin: 'ƒçovek', meaning: 'person, man' },
            { cyrillic: '–∂–µ–Ω–∞', latin: '≈æena', meaning: 'woman' },
            { cyrillic: '–¥–µ—Ç–µ', latin: 'dete', meaning: 'child' },
            { cyrillic: '–∫—É—õ–∞', latin: 'kuƒáa', meaning: 'house' },
            { cyrillic: '–≤–æ–¥–∞', latin: 'voda', meaning: 'water' },
            { cyrillic: '–∑–µ–º—ô–∞', latin: 'zemlja', meaning: 'earth, country' },
            { cyrillic: '–Ω–µ–±–æ', latin: 'nebo', meaning: 'sky' },
            { cyrillic: '—Å—É–Ω—Ü–µ', latin: 'sunce', meaning: 'sun' },
            { cyrillic: '–º–µ—Å–µ—Ü', latin: 'mesec', meaning: 'moon, month' },
            { cyrillic: '–¥–∞–Ω', latin: 'dan', meaning: 'day' },
            { cyrillic: '–Ω–æ—õ', latin: 'noƒá', meaning: 'night' },
            { cyrillic: '–≤—Ä–µ–º–µ', latin: 'vreme', meaning: 'time, weather' },
            { cyrillic: '–≥–æ–¥–∏–Ω–∞', latin: 'godina', meaning: 'year' },
            { cyrillic: '–º–µ—Å—Ç–æ', latin: 'mesto', meaning: 'place' },
            { cyrillic: '—Ä—É–∫–∞', latin: 'ruka', meaning: 'hand, arm' },
            { cyrillic: '–Ω–æ–≥–∞', latin: 'noga', meaning: 'leg, foot' },
            { cyrillic: '–≥–ª–∞–≤–∞', latin: 'glava', meaning: 'head' },
            { cyrillic: '–æ–∫–æ', latin: 'oko', meaning: 'eye' },
            { cyrillic: '—Å—Ä—Ü–µ', latin: 'srce', meaning: 'heart' },
            { cyrillic: '—ô—É–±–∞–≤', latin: 'ljubav', meaning: 'love' },
            { cyrillic: '–ø—Ä–∏—ò–∞—Ç–µ—ô', latin: 'prijatelj', meaning: 'friend' },
            { cyrillic: '–ø–æ—Ä–æ–¥–∏—Ü–∞', latin: 'porodica', meaning: 'family' },
            { cyrillic: '–±—Ä–∞—Ç', latin: 'brat', meaning: 'brother' },
            { cyrillic: '—Å–µ—Å—Ç—Ä–∞', latin: 'sestra', meaning: 'sister' },
            { cyrillic: '–æ—Ç–∞—Ü', latin: 'otac', meaning: 'father' },
            { cyrillic: '–º–∞—ò–∫–∞', latin: 'majka', meaning: 'mother' },
            { cyrillic: '—Å–∏–Ω', latin: 'sin', meaning: 'son' },
            { cyrillic: '–∫—õ–µ—Ä–∫–∞', latin: 'kƒáerka', meaning: 'daughter' },
            { cyrillic: '—à–∫–æ–ª–∞', latin: '≈°kola', meaning: 'school' },
            { cyrillic: '–∫—ö–∏–≥–∞', latin: 'knjiga', meaning: 'book' },
            { cyrillic: '–ø–∏—Å–∞—Ç–∏', latin: 'pisati', meaning: 'to write' },
            { cyrillic: '—á–∏—Ç–∞—Ç–∏', latin: 'ƒçitati', meaning: 'to read' },
            { cyrillic: '—É—á–∏—Ç–∏', latin: 'uƒçiti', meaning: 'to learn' },
            { cyrillic: '—Ä–∞–¥–∏—Ç–∏', latin: 'raditi', meaning: 'to work' },
            { cyrillic: '–∏–≥—Ä–∞—Ç–∏', latin: 'igrati', meaning: 'to play' },
            { cyrillic: '–ø–µ–≤–∞—Ç–∏', latin: 'pevati', meaning: 'to sing' },
            { cyrillic: '—Å–ø–∞–≤–∞—Ç–∏', latin: 'spavati', meaning: 'to sleep' },
            { cyrillic: '—ò–µ—Å—Ç–∏', latin: 'jesti', meaning: 'to eat' },
            { cyrillic: '–ø–∏—Ç–∏', latin: 'piti', meaning: 'to drink' },
            { cyrillic: '–≥–æ–≤–æ—Ä–∏—Ç–∏', latin: 'govoriti', meaning: 'to speak' },
            { cyrillic: '—Å–ª—É—à–∞—Ç–∏', latin: 'slu≈°ati', meaning: 'to listen' },
            { cyrillic: '–º–∏—Å–ª–∏—Ç–∏', latin: 'misliti', meaning: 'to think' },
            { cyrillic: '–æ—Å–µ—õ–∞—Ç–∏', latin: 'oseƒáati', meaning: 'to feel' },
            { cyrillic: '–≤–æ–ª–µ—Ç–∏', latin: 'voleti', meaning: 'to love' },
            { cyrillic: '–∂–∏–≤–µ—Ç–∏', latin: '≈æiveti', meaning: 'to live' },
            { cyrillic: '—É–º—Ä–µ—Ç–∏', latin: 'umreti', meaning: 'to die' },
            { cyrillic: '—Ä–æ—í–µ—ö–µ', latin: 'roƒëenje', meaning: 'birth' },
            { cyrillic: '–∂–∏–≤–æ—Ç', latin: '≈æivot', meaning: 'life' },
            { cyrillic: '—Å–º—Ä—Ç', latin: 'smrt', meaning: 'death' },
            { cyrillic: '—Å—Ä–µ—õ–∞', latin: 'sreƒáa', meaning: 'happiness' },
            { cyrillic: '—Ç—É–≥–∞', latin: 'tuga', meaning: 'sadness' },
            { cyrillic: '—Å—Ç—Ä–∞—Ö', latin: 'strah', meaning: 'fear' },
            { cyrillic: '–Ω–∞–¥–∞', latin: 'nada', meaning: 'hope' },
            { cyrillic: '–º–∏—Ä', latin: 'mir', meaning: 'peace' },
            { cyrillic: '—Ä–∞—Ç', latin: 'rat', meaning: 'war' },
            { cyrillic: '–∑–¥—Ä–∞–≤—ô–µ', latin: 'zdravlje', meaning: 'health' },
            { cyrillic: '–±–æ–ª–µ—Å—Ç', latin: 'bolest', meaning: 'illness' },
            { cyrillic: '–ª–µ–∫–∞—Ä', latin: 'lekar', meaning: 'doctor' },
            { cyrillic: '–±–æ–ª–Ω–∏—Ü–∞', latin: 'bolnica', meaning: 'hospital' },
            { cyrillic: '–ª–µ–∫', latin: 'lek', meaning: 'medicine' },
            { cyrillic: '—Ö—Ä–∞–Ω–∞', latin: 'hrana', meaning: 'food' },
            { cyrillic: '—Ö–ª–µ–±', latin: 'hleb', meaning: 'bread' },
            { cyrillic: '–º–µ—Å–æ', latin: 'meso', meaning: 'meat' },
            { cyrillic: '—Ä–∏–±–∞', latin: 'riba', meaning: 'fish' },
            { cyrillic: '–≤–æ—õ–µ', latin: 'voƒáe', meaning: 'fruit' },
            { cyrillic: '–ø–æ–≤—Ä—õ–µ', latin: 'povrƒáe', meaning: 'vegetables' },
            { cyrillic: '–º–ª–µ–∫–æ', latin: 'mleko', meaning: 'milk' },
            { cyrillic: '—ò–∞—ò–µ', latin: 'jaje', meaning: 'egg' },
            { cyrillic: '—Å–∏—Ä', latin: 'sir', meaning: 'cheese' },
            { cyrillic: '—à–µ—õ–µ—Ä', latin: '≈°eƒáer', meaning: 'sugar' },
            { cyrillic: '—Å–æ', latin: 'so', meaning: 'salt' },
            { cyrillic: '–∫–∞—Ñ–∞', latin: 'kafa', meaning: 'coffee' },
            { cyrillic: '—á–∞—ò', latin: 'ƒçaj', meaning: 'tea' },
            { cyrillic: '–ø–∏–≤–æ', latin: 'pivo', meaning: 'beer' },
            { cyrillic: '–≤–∏–Ω–æ', latin: 'vino', meaning: 'wine' },
            { cyrillic: '–∞—É—Ç–æ–º–æ–±–∏–ª', latin: 'automobil', meaning: 'car' },
            { cyrillic: '–≤–æ–∑', latin: 'voz', meaning: 'train' },
            { cyrillic: '–∞–≤–∏–æ–Ω', latin: 'avion', meaning: 'airplane' },
            { cyrillic: '–±—Ä–æ–¥', latin: 'brod', meaning: 'ship' },
            { cyrillic: '–±–∏—Ü–∏–∫–ª', latin: 'bicikl', meaning: 'bicycle' },
            { cyrillic: '–ø—É—Ç', latin: 'put', meaning: 'road, journey' },
            { cyrillic: '–≥—Ä–∞–¥', latin: 'grad', meaning: 'city' },
            { cyrillic: '—Å–µ–ª–æ', latin: 'selo', meaning: 'village' },
            { cyrillic: '—Ä–µ–∫–∞', latin: 'reka', meaning: 'river' },
            { cyrillic: '–º–æ—Ä–µ', latin: 'more', meaning: 'sea' },
            { cyrillic: '–ø–ª–∞–Ω–∏–Ω–∞', latin: 'planina', meaning: 'mountain' },
            { cyrillic: '—à—É–º–∞', latin: '≈°uma', meaning: 'forest' },
            { cyrillic: '–¥—Ä–≤–æ', latin: 'drvo', meaning: 'tree' },
            { cyrillic: '—Ü–≤–µ—Ç', latin: 'cvet', meaning: 'flower' },
            { cyrillic: '—Ç—Ä–∞–≤–∞', latin: 'trava', meaning: 'grass' },
            { cyrillic: '–∂–∏–≤–æ—Ç–∏—ö–∞', latin: '≈æivotinja', meaning: 'animal' },
            { cyrillic: '–ø–∞—Å', latin: 'pas', meaning: 'dog' },
            { cyrillic: '–º–∞—á–∫–∞', latin: 'maƒçka', meaning: 'cat' },
            { cyrillic: '–∫–æ—ö', latin: 'konj', meaning: 'horse' },
            { cyrillic: '–ø—Ç–∏—Ü–∞', latin: 'ptica', meaning: 'bird' }
        ];

        // Anki SM-2 Algorithm implementation
        class Card {
            constructor(data, id) {
                this.id = id;
                this.data = data;
                this.easeFactor = 2.5;
                this.repetitions = 0;
                this.interval = 1;
                this.dueDate = new Date();
                this.isNew = true;
                this.isLearning = false;
            }

            grade(quality) {
                if (this.isNew) {
                    this.isNew = false;
                    this.isLearning = true;
                }

                if (quality < 2) {
                    this.repetitions = 0;
                    this.interval = 1;
                    this.isLearning = true;
                } else {
                    if (this.repetitions === 0) {
                        this.interval = 1;
                    } else if (this.repetitions === 1) {
                        this.interval = 6;
                    } else {
                        this.interval = Math.round(this.interval * this.easeFactor);
                    }

                    this.repetitions++;
                    this.easeFactor = this.easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
                    
                    if (this.easeFactor < 1.3) {
                        this.easeFactor = 1.3;
                    }

                    if (this.repetitions > 1) {
                        this.isLearning = false;
                    }
                }

                this.dueDate = new Date();
                this.dueDate.setDate(this.dueDate.getDate() + this.interval);
                this.save();
            }

            isDue() {
                return new Date() >= this.dueDate;
            }

            save() {
                const storageKey = this.storageKey || 'serbianCards';
                const cards = JSON.parse(localStorage.getItem(storageKey) || '{}');
                cards[this.id] = {
                    easeFactor: this.easeFactor,
                    repetitions: this.repetitions,
                    interval: this.interval,
                    dueDate: this.dueDate.toISOString(),
                    isNew: this.isNew,
                    isLearning: this.isLearning
                };
                localStorage.setItem(storageKey, JSON.stringify(cards));
            }

            static load(data, id, storageKey = 'serbianCards') {
                const cards = JSON.parse(localStorage.getItem(storageKey) || '{}');
                const card = new Card(data, id);
                card.storageKey = storageKey;
                
                if (cards[id]) {
                    const saved = cards[id];
                    card.easeFactor = saved.easeFactor;
                    card.repetitions = saved.repetitions;
                    card.interval = saved.interval;
                    card.dueDate = new Date(saved.dueDate);
                    card.isNew = saved.isNew;
                    card.isLearning = saved.isLearning;
                }
                
                return card;
            }
        }

        // Game state
        let cards = [];
        let currentCard = null;
        let isShowingAnswer = false;
        let wordsMode = false;
        let practiceMode = false;
        let theme = 'auto';

        // Theme management
        function applyTheme(themeValue) {
            // Check for vibe mode
            const isVibeMode = window.location.hash === '#vibe';
            
            if (isVibeMode) {
                document.documentElement.classList.add('vibe');
                document.documentElement.classList.remove('dark');
                return;
            } else {
                document.documentElement.classList.remove('vibe');
            }
            
            if (themeValue === 'auto') {
                // Use system preference
                if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            } else if (themeValue === 'dark') {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }
        
        // Listen for hash changes to toggle vibe mode
        window.addEventListener('hashchange', function() {
            applyTheme(theme);
        });

        function changeTheme() {
            const select = document.getElementById('themeSelect');
            theme = select.value;
            applyTheme(theme);
            saveSettings();
        }

        // Listen for system theme changes when in auto mode
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
            if (theme === 'auto') {
                applyTheme('auto');
            }
        });

        // Settings management
        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('serbianSettings') || '{}');
            wordsMode = settings.wordsMode || false;
            practiceMode = settings.practiceMode || false;
            theme = settings.theme || 'auto';
            applyTheme(theme);
            updateSettingsUI();
        }

        function saveSettings() {
            const settings = { wordsMode, practiceMode, theme };
            localStorage.setItem('serbianSettings', JSON.stringify(settings));
        }

        function updateSettingsUI() {
            const wordsToggle = document.getElementById('wordsToggle');
            if (wordsMode) {
                wordsToggle.classList.add('active');
            } else {
                wordsToggle.classList.remove('active');
            }
            
            const practiceToggle = document.getElementById('practiceToggle');
            const practiceModeIndicator = document.getElementById('practiceModeIndicator');
            if (practiceMode) {
                practiceToggle.classList.add('active');
                practiceModeIndicator.classList.remove('hidden');
            } else {
                practiceToggle.classList.remove('active');
                practiceModeIndicator.classList.add('hidden');
            }
            
            const themeSelect = document.getElementById('themeSelect');
            themeSelect.value = theme;
        }

        // Initialize cards
        function initializeCards() {
            const dataSource = wordsMode ? commonWords : alphabet;
            const storageKey = wordsMode ? 'serbianWordsCards' : 'serbianCards';
            cards = dataSource.map((data, index) => Card.load(data, index, storageKey));
        }

        // Get next card to study
        function getNextCard() {
            // In practice mode, show all cards that have been studied at least once
            if (practiceMode) {
                const studiedCards = cards.filter(card => !card.isNew);
                if (studiedCards.length > 0) {
                    return studiedCards[Math.floor(Math.random() * studiedCards.length)];
                }
                // If no cards have been studied yet, fall back to new cards
                const newCards = cards.filter(card => card.isNew);
                if (newCards.length > 0) {
                    return newCards[Math.floor(Math.random() * newCards.length)];
                }
                return null;
            }
            
            // Normal mode: only show due cards
            const dueCards = cards.filter(card => card.isDue());
            const newCards = dueCards.filter(card => card.isNew);
            const learningCards = dueCards.filter(card => card.isLearning && !card.isNew);
            const reviewCards = dueCards.filter(card => !card.isNew && !card.isLearning);

            // Prioritize: learning cards, then new cards, then review cards
            if (learningCards.length > 0) {
                return learningCards[Math.floor(Math.random() * learningCards.length)];
            } else if (newCards.length > 0) {
                return newCards[Math.floor(Math.random() * newCards.length)];
            } else if (reviewCards.length > 0) {
                return reviewCards[Math.floor(Math.random() * reviewCards.length)];
            }

            return null;
        }

        // Calculate advanced statistics
        function calculateStats() {
            // In practice mode, show all cards as available
            if (practiceMode) {
                const newCount = cards.filter(card => card.isNew).length;
                const learningCount = cards.filter(card => card.isLearning && !card.isNew).length;
                const reviewCount = cards.filter(card => !card.isNew && !card.isLearning).length;
                
                // Continue with rest of function using all cards
                const totalCards = cards.length;
                const studiedCards = cards.filter(card => !card.isNew);
                const matureCards = cards.filter(card => card.interval >= 21 && !card.isNew && !card.isLearning);
                const youngCards = studiedCards.filter(card => card.interval < 21 && !card.isLearning);
                const averageEase = studiedCards.length > 0 ? 
                    studiedCards.reduce((sum, card) => sum + card.easeFactor, 0) / studiedCards.length : 2.5;
                const retentionRate = studiedCards.length > 0 ? 
                    (studiedCards.filter(card => card.easeFactor >= 2.5).length / studiedCards.length) * 100 : 100;
                
                return {
                    newCount,
                    learningCount, 
                    reviewCount,
                    totalCards,
                    studiedCards: studiedCards.length,
                    matureCards: matureCards.length,
                    youngCards: youngCards.length,
                    averageEase: Math.round(averageEase * 100) / 100,
                    retentionRate: Math.round(retentionRate),
                    masteryProgress: Math.round((matureCards.length / totalCards) * 100)
                };
            }
            
            // Normal mode: only count due cards
            const dueCards = cards.filter(card => card.isDue());
            const newCount = dueCards.filter(card => card.isNew).length;
            const learningCount = dueCards.filter(card => card.isLearning && !card.isNew).length;
            const reviewCount = dueCards.filter(card => !card.isNew && !card.isLearning).length;
            
            // Advanced metrics
            const totalCards = cards.length;
            const studiedCards = cards.filter(card => !card.isNew);
            const matureCards = cards.filter(card => card.interval >= 21 && !card.isNew && !card.isLearning);
            const youngCards = studiedCards.filter(card => card.interval < 21 && !card.isLearning);
            const averageEase = studiedCards.length > 0 ? 
                studiedCards.reduce((sum, card) => sum + card.easeFactor, 0) / studiedCards.length : 2.5;
            const retentionRate = studiedCards.length > 0 ? 
                (studiedCards.filter(card => card.easeFactor >= 2.5).length / studiedCards.length) * 100 : 100;
            
            return {
                newCount,
                learningCount, 
                reviewCount,
                totalCards,
                studiedCards: studiedCards.length,
                matureCards: matureCards.length,
                youngCards: youngCards.length,
                averageEase: Math.round(averageEase * 100) / 100,
                retentionRate: Math.round(retentionRate),
                masteryProgress: Math.round((matureCards.length / totalCards) * 100)
            };
        }

        // Update statistics
        function updateStats() {
            const stats = calculateStats();

            document.getElementById('newCards').textContent = stats.newCount;
            document.getElementById('learningCards').textContent = stats.learningCount;
            document.getElementById('reviewCards').textContent = stats.reviewCount;

            // Update progress bar to show mastery progress
            document.getElementById('progressBar').style.width = stats.masteryProgress + '%';
            document.getElementById('progressText').textContent = `${stats.masteryProgress}% mastered`;
            
            // Update detailed statistics in settings
            document.getElementById('statsTotalCards').textContent = stats.totalCards;
            document.getElementById('statsStudiedCards').textContent = stats.studiedCards;
            document.getElementById('statsMatureCards').textContent = stats.matureCards;
            document.getElementById('statsYoungCards').textContent = stats.youngCards;
            document.getElementById('statsAverageEase').textContent = stats.averageEase.toFixed(2);
            document.getElementById('statsRetentionRate').textContent = stats.retentionRate + '%';
            document.getElementById('statsMasteryProgress').textContent = stats.masteryProgress + '%';
        }

        // Show next card
        function showNextCard() {
            currentCard = getNextCard();
            
            if (!currentCard) {
                document.getElementById('cardContent').textContent = 'üéâ All done for now!';
                document.getElementById('cardAnswer').classList.add('hidden');
                document.getElementById('showBtn').classList.add('hidden');
                const gradeButtons = document.getElementById('gradeButtons');
                gradeButtons.classList.add('hidden');
                gradeButtons.classList.remove('flex');
                return;
            }

            document.getElementById('cardContent').textContent = currentCard.data.cyrillic;
            
            let answerHtml;
            if (wordsMode) {
                answerHtml = `<strong>Latin:</strong> ${currentCard.data.latin}<br>
                             <strong>Meaning:</strong> ${currentCard.data.meaning}`;
            } else {
                answerHtml = `<strong>Latin:</strong> ${currentCard.data.latin}<br>
                             <span class="text-xs">${currentCard.data.sound}</span>`;
            }
            
            document.getElementById('cardAnswer').innerHTML = answerHtml;
            document.getElementById('cardAnswer').classList.add('hidden');
            document.getElementById('card').classList.remove('flipped');
            
            document.getElementById('showBtn').classList.remove('hidden');
            const gradeButtons = document.getElementById('gradeButtons');
            gradeButtons.classList.add('hidden');
            gradeButtons.classList.remove('flex');
            
            isShowingAnswer = false;
        }

        // Show answer
        function showAnswer() {
            document.getElementById('cardAnswer').classList.remove('hidden');
            document.getElementById('card').classList.add('flipped');
            document.getElementById('showBtn').classList.add('hidden');
            const gradeButtons = document.getElementById('gradeButtons');
            gradeButtons.classList.remove('hidden');
            gradeButtons.classList.add('flex');
            isShowingAnswer = true;
        }

        // Grade card
        function gradeCard(quality) {
            if (!isShowingAnswer) return;
            
            currentCard.grade(quality);
            updateStats();
            showNextCard();
        }

        // Reset progress
        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
                localStorage.removeItem('serbianCards');
                localStorage.removeItem('serbianWordsCards');
                initializeCards();
                updateStats();
                showNextCard();
            }
        }

        // Settings functions
        function openSettings() {
            document.getElementById('settingsScreen').classList.remove('hidden');
        }

        function closeSettings() {
            document.getElementById('settingsScreen').classList.add('hidden');
        }

        // Close settings when clicking outside the modal
        document.getElementById('settingsScreen').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSettings();
            }
        });

        function toggleWords() {
            wordsMode = !wordsMode;
            saveSettings();
            updateSettingsUI();
            initializeCards();
            updateStats();
            showNextCard();
        }
        
        function togglePracticeMode() {
            practiceMode = !practiceMode;
            saveSettings();
            updateSettingsUI();
            updateStats();
            showNextCard();
        }

        // Initialize app
        loadSettings();
        initializeCards();
        updateStats();
        showNextCard();

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (!isShowingAnswer && e.code === 'Space') {
                e.preventDefault();
                showAnswer();
            } else if (isShowingAnswer) {
                switch(e.key) {
                    case '1':
                        gradeCard(0);
                        break;
                    case '2':
                        gradeCard(1);
                        break;
                    case '3':
                        gradeCard(2);
                        break;
                    case '4':
                        gradeCard(3);
                        break;
                }
            }
        });
    </script>
</body>
</html>